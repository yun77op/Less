define("less/app/0.0.1/lib/oauth2",["../util"],function(e,t){function r(e,t,n){this.client_id=e,this.request_url=t,this.redirect_url=n,this.key_token="oauth2_token"}function s(e,t,n,r){n=n||{},this.multi=r,r&&(this.pic=n.pic,delete n.pic),this.method=e.toUpperCase(),this.url=t,this.params=n,this._nonce_chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}var n=e("../util"),i=r.prototype;return i.hasToken=function(){return!!this.getToken()},i.getToken=function(){return this.token||localStorage[this.key_token]},i.setToken=function(e){this.token=e,localStorage[this.key_token]=e},i.clearToken=function(){delete this.token,delete localStorage[this.key_token]},i.getAccessURL=function(){var e=this.request_url,t={client_id:this.client_id,redirect_uri:this.redirect_url,response_type:"token"};return n.addURLParam(e,t)},i.request=function(e,t,n,r,i){i=arguments[arguments.length-1],typeof r!="boolean"&&(r=!1),typeof n=="function"&&(i=n,n={});var o=new s(e,t,n,r),u=o.generate();this.hasToken()&&(u.headers.Authorization="OAuth2 "+this.getToken()),this.sendRequest(e,u.signed_url,u.headers,u.body,function(e,t){i(e,t)})},i.get=function(){var e=["GET"].concat(arguments);this.request.apply(this,e)},i.post=function(){var e=["POST"].concat(arguments);this.request.apply(this,e)},i.sendRequest=function(e,t,n,r,i){var s=new XMLHttpRequest;s.onreadystatechange=function(){this.readyState==4&&i(JSON.parse(this.responseText),this)},s.open(e,t,!0);if(n)for(var o in n)n.hasOwnProperty(o)&&s.setRequestHeader(o,n[o]);return s.send(r),s},i=s.prototype,i.generate=function(){return{body:this.getBody(),signed_url:this.getSingedURL(),headers:this.getHeaders()}},i.getHeaders=function(){var e={};return e["Content-Type"]=this.multi?"multipart/form-data; boundary="+this.boundary:"application/x-www-form-urlencoded",e},i.getSingedURL=function(){var e=this.url;return this.method=="GET"&&(e=n.addURLParam(e,this.params)),this.signed_url=e,e},i.getBody=function(){if(this.method=="GET")return null;var e;if(this.multi){this.getUniqueBoundary();var t=this.boundary,r="\r\n",i="--",s=this.pic,o="",u="";o=i+t+r;for(var a in this.params)o+='Content-Disposition: form-data; name="'+a+'"'+r+r,o+=this.params[a]+r,o+=i,o+=t,o+=r;o+='Content-Disposition: form-data; name="pic"; filename="'+s.fileName+'"'+r,o+="Content-Type: "+s.fileType+r+r,u=r,u+=i,u+=t,u+=i,u+=r,e=new Blob([o,s,u],{type:"application/octet-binary"})}else e=n.stringify(this.params);return e},i.getUniqueBoundary=function(){var e="",t=10,n=this._nonce_chars.length;for(var r=0;r<t;r++){var i=Math.floor(Math.random()*n);e+=this._nonce_chars.substring(i,i+1)}return this.boundary="----boundary"+e,this},app.addSingletonGetter(r),r}),define("less/app/0.0.1/util",[],function(e,t){function n(e,t){t=t===undefined?"&":t;var n=e.split(t),i={};for(var s=0,o;o=n[s];s++){var u=o.split("=");if(u.length==2){var a=r(u[0]),f=r(u[1]);i[a]=f}}return i}function r(e){var t=e.replace(/%21/g,"!").replace(/%2A/g,"*").replace(/%27/g,"'").replace(/%28/g,"(").replace(/%29/g,")");return decodeURIComponent(t)}function i(e){return encodeURIComponent(e).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}function s(e,t,n){if(typeof t!="object"){var s=e.indexOf("?")>=0?"&":"?";return e+s+i(t)+"="+i(n)}var r=t;return a(r)?e:e+"?"+o(r)}function o(e){var t="";for(var n in e)t+=i(n)+"="+i(e[n])+"&";return t.slice(0,-1)}function u(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;return t.setTime(e.getTime()),t}if(e instanceof Array){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=u(e[n]);return t}if(e instanceof Object){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=u(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")}function a(e){for(var t in e)return!1;return!0}function f(){var e;return(e=window.location.search)?(e=e.slice(1),n(e)):{}}function l(){var e;return(e=window.location.hash)?(e=e.slice(1),n(e)):{}}function m(e){return e=""+e,e=e.toString().replace(c,"&amp;"),e=e.replace(h,"&lt;"),e=e.replace(p,"&gt;"),e=e.replace(d,"&quot;"),e=e.replace(v,"&#39;"),e}function E(e){return e=""+e,e=e.toString().replace(g,">"),e=e.replace(y,"<"),e=e.replace(b,'"'),e=e.replace(b,'"'),e=e.replace(w,"'"),e}function S(e,t){var n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),document.head.appendChild(n)}function x(e,t,n,r){var i=0;return n&&(i=Math.max(i,e/n)),r&&(i=Math.max(i,t/r)),i>1&&(e=parseInt(e/i),t=parseInt(t/i)),{width:e,height:t}}function T(e,t){e=new Date(e);var n=e.getTime(),r=(new Date).getTime()-n,i=1e3,s=6e4,o=60*s,u=24*o,a,f={days:u,hours:o,minutes:s,seconds:i},l=r/u;if(l>5)a=[e.getFullYear(),e.getMonth()+1,e.getDate()].join("-")+" "+e.toLocaleTimeString();else for(var c in f){l=r/f[c];if(l>1){a=Math.round(l)+" "+chrome.i18n.getMessage(c)+" "+chrome.i18n.getMessage("ago");break}}return a}var c=/&/g,h=/</g,p=/>/g,d=/"/g,v=/'/g,g=/\&gt\;/g,y=/\&lt\;/g,b=/\&quot\;/g,w=/\&#39\;/g;return{clone:u,formDecode:n,toRfc3986:i,fromRfc3986:r,addURLParam:s,stringify:o,parseQueryString:f,parseHashString:l,htmlDecode:E,htmlEncode:m,html:m,loadStyle:S,scale:x,dateFormat:T}}),define("less/app/0.0.1/tweet_plugin",["./util"],function(e){function n(){t={};var e={};e.forEach(function(e){t[e.value]=e.url})}var t,r=e("./util"),i=[function(t){return t.replace(/\b(http:\/\/[\w\.\/]+)/g,function(e,t){return'<a target="_blank" href="'+t+'">'+t+"</a>"})},function(t){return t.replace(/#([^\#]*?)#/g,function(e,t){return'<a target="_blank" href="http://weibo.com/k/'+r.fromRfc3986(t)+'">'+e+"</a>"})},function(n){return t?n.replace(/\[([^\]]*?)\]/g,function(e,n){var r=t[e];return r?'<img src="'+r+'" title="'+n+'" alt="'+e+'">':e}):n},function(t){return t.replace(/@([\u4e00-\u9fa5\w-]+)/g,function(e,t){return'<a class="name" href="#user/'+r.toRfc3986(t)+'">@'+t+"</a>"})}];return{process:function(e){return i.reduce(function(e,t){return t(e)},e)}}}),define("less/app/0.0.1/modules/mini_profile",["../models/signed-user","../models/user","../models/stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n='<div class="flex-module"><div class="profile-summary"><a href="#!/{{id}}"><div class="content"><img src="{{profile_image_url}}" class="avatar"> <b class="fullname">{{screen_name}}</b><small class="meta">View my profile page</small></div></a></div></div><div class="flex-module">{{> profile-stats}}</div>',r=e("../models/signed-user"),i=Backbone.Module.extend({name:"mini-profile",className:"module",template:n,placeholder:"Loading..",initialize:function(){this.model=new r,i.__super__.initialize.apply(this,arguments)}});return{main:i,args:{data:{uid:localStorage.uid}}}}),define("less/app/0.0.1/models/signed-user",["./user","./stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("./user");return n.extend({storeID:"user"})}),define("less/app/0.0.1/models/user",["./stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("./stream"),r=n.extend({url:"users/show.json"});return r}),define("less/app/0.0.1/models/stream",["../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("../weibo"),r={create:"POST",update:"PUT","delete":"DELETE",read:"GET"},i=Backbone.Model.extend({sync:function(e,t,i){var s={path:t.url,method:r[e],params:i.data};if(_.isString(t.storeID)){var o=i.success;if(e=="read"){var u=localStorage.getItem(t.storeID);if(u)return u=JSON.parse(u),o(u)}i.success=function(e,n,r){localStorage.setItem(t.storeID,JSON.stringify(e)),o(e,n,r)}}n.request(s,{success:i.success,error:i.error})}});return i}),define("less/app/0.0.1/weibo",["./lib/oauth2","./util","./message"],function(e,t){function s(e,t,n){var r=i[e];if(!r)return;typeof t=="function"&&(n=t,t={}),o({path:r,params:t},n)}function o(e,t){var r=e.base_url||"https://api.weibo.com/2/",i=r+e.path,s=e.method||"GET",u=e.multi||!1;n.request(s,i,e.params,u,function(e,n){if(e.error_code&&e.error_code<=21332&&e.error_code>=21322){window.location.href=chrome.extension.getURL("login.html");return}var r=typeof t=="object",i=r&&t.error?t.error:o.errorHandler,s=r?t.success:t;n.status==200?s(e,n.status,n):i(e,n)})}var n=e("./lib/oauth2").getInstance(),r=e("./message");const i={timeline:"statuses/home_timeline.json",mentions:"statuses/mentions.json",user:"statuses/user_timeline.json",comments:"comments/to_me.json","comments-tome":"comments/to_me.json","comments-byme":"comments/by_me.json",favorites:"favorites.json",follows:"friendships/friends.json",followers:"friendships/followers.json"};return window.errorHandler=o.errorHandler=function(e,t){r.createMessage({text:e.error,actions:[{label:"Ok",click:function(){this.hide()}}],className:"error"})},{request:o}}),define("less/app/0.0.1/message",[],function(e,t){var n=function(){this.initialize.apply(this,arguments)};return n.prototype={constructor:n,initialize:function(e){var e=$.extend({},n.defaults,e),t=this;this.option(e);var r=this.$el=$('<div class="message"><div class="message-inner"><span class="message-text">'+e.text+"</span></div></div>");if(e.actions){var i=$('<div class="message-actions" />');e.actions.forEach(function(e){var n=$('<button class="btn-link">'+e.label+"</button>");n.click(_.bind(e.click,t)),i.append(n)}),r.find(".message-inner").append(i)}typeof e.className=="string"&&r.addClass(this.options.className),_.bindAll(this,"hide"),this.option("autoOpen")&&this.show()},show:function(){this.$el.appendTo("body"),this.option("autoHide")&&this.addTimer()},hide:function(){this.$el.remove()},addTimer:function(){this.timer=window.setTimeout(this.hide,this.option("hideTimeout"))},clearTimer:function(){this.timer&&window.clearTimeout(this.timer)}},_.extend(n.prototype,app.Options),n.defaults={hideTimeout:4e3,autoOpen:!0,autoHide:!0},{createMessage:function(e){return new n(e)}}}),define("less/app/0.0.1/modules/weibo-emoticons",["../models/stream","../weibo","../lib/oauth2","../util","../message"],function(e){var t='<a href="#" class="dropdown-toggle action-emoticons" data-toggle="dropdown" i18n-content="emoticons">Emoticons</a><div class="dropdown-menu emoticons" role="menu"><div class="emoticons-header"><ul class="emoticons-category-list"></ul><div class="emoticons-nav"><button class="nav-prev" disabled>&lt;</button><button class="nav-next" disabled>&gt;</button></div></div><div class="emoticons-body"><div class="loadingArea"><img src="images/loading.gif"><span i18n-content="loading">Loading</span></div></div></div>',n=e("../models/stream"),r=n.extend({url:"emotions.json",storeID:"emotions"}),i=Backbone.Module.extend({name:"weibo-emoticons",tagName:"span",className:"dropdown",template:t,model:new r,initialize:function(){i.__super__.initialize.apply(this,arguments),this.initialized=!1,this.pageNum=5,this.currentPage=1,this.onReady(function(){var e=this;if(this.initialized)return;this.model.fetch({success:function(){e.initialized=!0,e.initializeUI()}})})},events:{"click .emoticons-body img":"appendFace","click .nav-prev":"navPrev","click .nav-next":"navNext","click .emoticons-category-list a":"showEmoticonsByCategory"},initializeUI:function(){var e={};_.each(this.model.attributes,function(t,n){if(n!=parseInt(n))return;var r=t.category||"默认";e[r]||(e[r]=[]),e[r].push(t)});var t=_.keys(e);this.model.set({emoticons:e,categories:t}),this.setupNav()},setupFaces:function(e){var t='<ul>{{#each emoticons}}<li><img width="22" height="22" title="{{this.title}}" data-emoticon="{{this.phrase}}" src="{{this.icon}}" alt="{{this.phrase}}"></li>{{/each}}</ul>',n=Handlebars.compile(t),r=this.model.get("emoticons")[e];r=r.map(function(e,t){return e.title=e.phrase.slice(1,-1),e});var i=n({emoticons:r});this.$el.find(".emoticons-body").html(i)},setupNav:function(){var e=this.model.get("categories"),t=Math.ceil(e.length/this.pageNum);this.totalPage=t,this.renderNav(1),this.checkNav()},checkNav:function(){this.el.querySelector(".nav-prev").disabled=this.currentPage==1?!0:!1,this.el.querySelector(".nav-next").disabled=this.currentPage==this.totalPage?!0:!1},appendFace:function(e){var t=e.currentTarget,n=document.querySelector(".status-editor"),r=n.value,i=n.selectionStart,s=t.getAttribute("data-emoticon");n.value=r.slice(0,i)+s+r.slice(n.selectionEnd),n.selectionStart=n.selectionStart=i+s.length},renderNav:function(e){var t='{{#each categories}}<li><a href="#" data-category="{{this}}">{{this}}</a></li>{{/each}}',n=Handlebars.compile(t),r=this.model.get("categories"),i=r.slice((e-1)*this.pageNum,e*this.pageNum),s=n({categories:i});this.$el.find(".emoticons-category-list").html(s),this.setupFaces(i[0]),this.el.querySelector(".emoticons-category-list li:first-child").classList.add("active"),this.currentPage=e},navPrev:function(e){e.stopPropagation(),this.renderNav(this.currentPage-1),this.checkNav()},navNext:function(e){e.stopPropagation(),this.renderNav(this.currentPage+1),this.checkNav()},showEmoticonsByCategory:function(e){e.preventDefault(),e.stopPropagation(),this.el.querySelector(".emoticons-category-list .active").classList.remove("active");var t=e.currentTarget;t.parentNode.classList.add("active");var n=t.getAttribute("data-category");this.setupFaces(n)}});return i}),define("less/app/0.0.1/modules/stream-picture",["../util"],function(e,t){var n='{{#unless expand}}<div class="tweet-pic-thumb" data-original="{{ original_pic }}"><img src="{{ thumbnail_pic }}"></div><img src="images/loading.gif" class="throbber" hidden>{{/unless}}<div class="tweet-pic-origin" {{#unless expand}}hidden{{/unless}}><div class="actions">{{#unless expand}}<a href="#" class="action-collapse">收起</a>{{/unless}}<a href="{{ original_pic }}" target="_blank" class="action-view-origin">查看大图</a><a href="#" class="action-rotate-left">左转</a><a href="#" class="action-rotate-right">右转</a></div>{{#if expand}}<img src="{{ original_pic }}">{{/if}}</div>',r=e("../util"),i=Backbone.Module.extend({name:"stream-picture",className:"tweet-pic",template:n,initialize:function(){i.__super__.initialize.apply(this,arguments),this.widthLimit=420,this.deg=0,this.options.expand&&this.model.set({expand:!0}),this.onReady(function(){this.originalEl=this.el.querySelector(".tweet-pic-origin"),this.options.expand||(this.thumbEl=this.el.querySelector(".tweet-pic-thumb"),_.bindAll(this,"collapse"),this.$el.on("click",".tweet-pic-origin img",this.collapse),this.$el.on("click",".tweet-pic-origin canvas",this.collapse))})},events:{"click .tweet-pic-thumb img":"show","click .action-collapse":"collapse","click .action-rotate-left":"rotateLeft","click .action-rotate-right":"rotateRight"},show:function(){this.inited?this.expand():this.load()},showThrobber:function(){var e=this.el.querySelector(".throbber"),t=this.el.querySelector(".tweet-pic-thumb img");e.style.left=t.width/2-8+"px",e.style.top=t.height/2-8+"px",e.style.display="block"},load:function(){this.showThrobber();var e=new Image;e.onload=this.onLoad.bind(this,e),e.src=this.model.get("original_pic")},onLoad:function(e){this.$el.find(".throbber").remove(),this.inited=!0,this.expand()},_show:function(){var e=document.createElement("img"),t;e.src=this.model.get("original_pic"),t=r.scale(e.width,e.height,this.widthLimit),e.width=t.width,e.height=t.height,this.originalEl.style.display="block",e.style.marginLeft=(this.widthLimit-t.width)/2+"px",this.originalEl.appendChild(e)},collapse:function(){var e=this.originalEl;e.removeChild(e.lastChild),e.style.display="none",this.thumbEl.style.display="block"},expand:function(){this.thumbEl.style.display="none",this._show()},rotateLeft:function(e){e.preventDefault(),this.deg-=90,this.rotate()},rotateRight:function(e){e.preventDefault(),this.deg+=90,this.rotate()},rotate:function(){var e=this.originalEl.querySelector("canvas"),t=document.createElement("img"),e;t.src=this.model.get("original_pic"),e||(e=document.createElement("canvas"),this.originalEl.replaceChild(e,this.originalEl.querySelector("img")));var n=e.getContext("2d");this.deg=this.deg+360,this.deg%=360;var i,s=[t.width,t.height];this.deg/90%2&&(i=!0,s=[s[1],s[0]]);var o=r.scale(s[0],s[1],this.widthLimit),u=[];switch(this.deg){case 0:u[0]=0,u[1]=0;break;case 90:u[0]=o.width,u[1]=0;break;case 180:u[0]=o.width,u[1]=o.height;break;case 270:u[0]=0,u[1]=o.height}e.width=o.width,e.height=o.height,e.style.marginLeft=(this.widthLimit-o.width)/2+"px",n.save(),n.translate(u[0]|0,u[1]|0),this.deg>0&&n.rotate(Math.PI*this.deg/180),i?n.drawImage(t,0,0,o.height,o.width):n.drawImage(t,0,0,o.width,o.height),n.restore()}});return i}),define("less/app/0.0.1/modules/stream-item",["../weibo","../lib/oauth2","../util","../message"],function(e){var t=e("../weibo"),n='{{#with user}}{{> stream-item-vcard}}{{/with}}<div class="stream-item-content"><div class="tweet">{{> stream-item-tweet-content}}{{#if retweeted_status}}{{#with retweeted_status}}<div class="tweet">{{> stream-item-tweet-content}}{{> stream-item-footer}}</div>{{/with}}{{/if}}{{> stream-item-footer}}</div></div>',r=JSON.parse(localStorage.getItem("uid")),i=Backbone.Module.extend({name:"stream-item",className:"stream-item",template:n,events:{"click .stream-item-primary-footer .action-repost":"repost","click .stream-item-primary-footer .action-comment":"comment","click .stream-item-primary-footer .action-favorite":"favorite","click .stream-item-primary-footer .action-del":"del"},initialize:function(){r==this.model.get("user").id&&this.model.set({action_del:!0}),this.model.set({action_fav:!0}),i.__super__.initialize.apply(this,arguments)},repost:function(e){e.preventDefault(),this._removeActiveCommentRepostList();if(this.activeListName=="mini-repost-list"){this.activeListName=null;return}this._setupList("mini-repost-list")},comment:function(e){e.preventDefault(),this._removeActiveCommentRepostList();if(this.activeListName=="mini-comment-list"){this.activeListName=null;return}this._setupList("mini-comment-list")},_setupList:function(e){var t=Backbone.application.getModuleInstance(e,{model:this.model.clone()});this.append(t,".stream-item-content > .tweet"),this.activeListName=t.name,this.miniCommentRepostList=t},_removeActiveCommentRepostList:function(){this.miniCommentRepostList&&(this.miniCommentRepostList.destroy(),this.miniCommentRepostList=null)},favorite:function(e){e.preventDefault();var n=this,r=e.currentTarget;if(r.disabled)return;r.disabled=!0;var i=r.classList.contains("favorited")?"destroy":"create",s=this.model.get("id");t.request({method:"POST",path:"favorites/"+i+".json",params:{id:s}},function(){r.disabled=!1,r.classList.toggle("favorited")})},del:function(e){e.preventDefault();var n=this;t.request({method:"POST",path:"statuses/destroy.json",params:{id:this.model.get("id")}},function(){n.$el.slideUp(function(){n.destroy()})})}});return i}),define("less/app/0.0.1/modules/user",[],function(e,t){var n='{{> stream-item-vcard}}<div class="stream-item-content"><div class="pull-right">{{#module this name="relationship-action"}} {{/module}}</div><strong>{{name}}</strong><p>{{description}}</p></div>',r=Backbone.Module.extend({name:"user",tagName:"li",className:"stream-item",template:n,follow:function(e){e.preventDefault();var t=e.target;if(t.disabled)return;t.disabled=!0;var n=t.classList.contains("followed"),r=n?"destroy":"create";app.weibo.request("POST","friendships/"+r,{uid:this.model.id},function(){app.message.show(chrome.i18n.getMessage(e+"Success"),!0),t.disabled=!1,t.classList.toggle("followed");var e=n?"follow":"unfollow";t.textContent=chrome.i18n.getMessage(e)})}});return r}),define("less/app/0.0.1/modules/home-timeline",["../reminder","../weibo","../lib/oauth2","../util","../message","./stream-item","../models/statuses","../models/stream","./timeline"],function(e,t){var n=e("../reminder"),r='<div class="status-unread-count hide"></div><div class="stream">{{#each this}}{{#module this name="stream-item"}}{{/module}}{{/each}}</div>',i=Array.prototype.slice,s=e("./stream-item"),o=e("../models/statuses"),u=e("./timeline"),a=u.extend({name:"home-timeline",template:r,StreamItem:s,events:{"click .status-unread-count":"_renderUnread"},initialize:function(){var e=i.call(arguments);n.on("status",this._handleUnread,this),this.model=new o,this.onReady(function(){this.$unreadCount=this.$el.find(".status-unread-count")}),a.__super__.initialize.apply(this,e)},_handleUnread:function(e){this.$unreadCount.text("有 "+e+" 条新微博，点击查看").show()},_renderUnread:function(){this.$unreadCount.hide(),this.fetch({data:{since_id:this.model.first().id},position:"prepend"})},destroy:function(){n.off("status",this._handleUnread,this),a.__super__.destroy.apply(this,arguments)}});return{main:a}}),define("less/app/0.0.1/reminder",["./weibo","./lib/oauth2","./util","./message"],function(e){function r(){n.request({base_url:"https://rm.api.weibo.com/2/",path:"remind/unread_count.json"},{success:function(e){var t,n;for(t in e)n=e[t],n&&i.trigger(t,n)},failure:function(){self.pollingInterval*=2}})}var t=12e4,n=e("./weibo");setInterval(function(){chrome.idle.queryState(30,function(e){var t=e=="active";if(!t||document.webkitHidden)return;r()})},t);var i=function(){};return _.extend(i,Backbone.Events),i}),define("less/app/0.0.1/models/statuses",["./stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("./stream"),r=Backbone.Collection.extend({model:Backbone.Model,url:"statuses/home_timeline.json",parse:function(e,t){return e.statuses},comparator:function(e,t){return t.get("id")-e.get("id")},sync:n.prototype.sync});return r}),define("less/app/0.0.1/modules/timeline",[],function(e,t){var n=Backbone.Module.extend({initialize:function(){this.onReady(function(){document.addEventListener("scroll",this._handleScroll,!1)}),this.unreadQueue=[],this.model.on("add",this.queueUnread,this),_.bindAll(this,"addUnread","_handleScroll"),this.options.cursor=this.options.cursor||"maxid";var e=this;if(this.options.cursor=="cursor"){var t=this.model.parse;this.model.parse=function(n,r){return e.next_cursor=n.next_cursor,t.apply(this,arguments)}}n.__super__.initialize.apply(this,arguments)},_handleScroll:function(){var e=document.body,t=100;if(this._scrollFetching||window.innerHeight+e.scrollTop+t<e.scrollHeight)return;var n={cursor:{cursor:this.next_cursor},maxid:{max_id:this.model.last().id}},r=_.extend({},this.options.data,n[this.options.cursor]),i={data:r,success:function(){this._scrollFetching=!1}.bind(this)};this._scrollFetching=!0,this.fetch(i)},fetch:function(e){var t=_.extend({},e,{add:!0});this.model.fetch(t)},queueUnread:function(e,t,n){e.url=null,this.unreadQueue.push(e),this.unreadTimeout||(setTimeout(this.addUnread,0),this.unreadQueueOptions=n,this.unreadTimeout=!0)},addUnread:function(){var e=document.createDocumentFragment(),t=this.StreamItem;this.unreadQueue.forEach(function(n){var r=(new t({model:n})).render().el;e.appendChild(r)});var n=this.unreadQueueOptions.position||"append";this.$el.find(".stream")[n](e),this.unreadQueue=[],this.unreadQueueOptions=null,this.unreadTimeout=!1},destroy:function(){document.removeEventListener("scroll",this._handleScroll,!1),n.__super__.destroy.apply(this,arguments)}});return n}),define("less/app/0.0.1/modules/status",["../models/stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n='<div>{{#with user}}<div class="pull-right">{{#module this name="relationship-action"}}{{/module}}</div>{{> stream-item-vcard}}{{/with}}</div><div class="tweet">{{> stream-item-tweet-content}}{{#if retweeted_status}}{{#with retweeted_status}}<div class="tweet">{{> stream-item-tweet-content}}{{> stream-item-footer}}</div>{{/with}}{{/if}}{{> stream-item-footer}}</div><ul class="nav nav-tabs"><li><a href="#reposts" data-type="repost" data-toggle="tab">转发{{reposts_count}}</a></li><li><a href="#comments" data-type="comment" data-toggle="tab">评论{{comments_count}}</a></li></ul><div class="tab-content"><div class="tab-pane" id="reposts">{{#module this name="mini-repost-list"}}{{/module}}</div><div class="tab-pane" id="comments">{{#module this name="mini-comment-list"}}{{/module}}</div></div>',r=e("../models/stream"),i=r.extend({url:"statuses/show.json"}),s=Backbone.Module.extend({name:"status",template:n,initialize:function(){s.__super__.initialize.apply(this,arguments),this.model=new i,this.onReady(function(){var e=this,t=this.el.querySelector(".tweet-pic");t&&new app.weibo.ImageView({el:t,expand:!0}),$('a[data-toggle="tab"]').on("show",function(){var t=$(this).data("type"),n=e.getChildModuleByName("mini-"+t+"-list")[0];n.refresh()}),$('a[href="#'+e.type+'s"]').tab("show")})},beforeEnter:function(e,t,n){this.options.data={id:t},this.type=n?n.slice(1):"repost"}});return{main:s,childConfig:{"mini-repost-list":{render:!1},"mini-comment-list":{render:!1},"stream-picture":{expand:!0}}}}),define("less/app/0.0.1/modules/stream",[],function(e,t){var n=Backbone.Module.extend({render:function(){this.$el.html(this.template());var e=this.model.attributes,t=$(".stream",this.$el),n=this.View;return e[e.key].forEach(function(e,r){var i=new n({model:e}),s=i.render().el;t.append(s)}),this},template:'<div class="stream"></div>'});return n}),define("less/app/0.0.1/modules/user-timeline",["../models/statuses","../models/stream","../weibo","../lib/oauth2","../util","../message","./stream-item","./timeline"],function(e){var t='<div class="stream">{{#each this}}{{#module this name="stream-item"}}{{/module}}{{/each}}</div>',n=e("../models/statuses"),r=e("./stream-item"),i=e("./timeline"),s=n.extend({url:"statuses/user_timeline.json"}),o=i.extend({name:"user-timeline",template:t,StreamItem:r,beforeEnter:function(e){this.options.data.uid=e},initialize:function(){this.model=new s,o.__super__.initialize.apply(this,arguments)}});return{main:o,args:{data:{}}}}),define("less/app/0.0.1/modules/comments",["./comment","../weibo","../lib/oauth2","../util","../message","./tweet-reply","./tweet-modal","./tweet","../models/user-comments","../models/stream","./timeline"],function(e,t){var n='<div class="stream">{{#each this}}{{#module this name="comment"}}{{/module}}{{/each}}</div>',r=Array.prototype.slice,i=e("./comment"),s=e("../models/user-comments"),o=e("./timeline"),u=o.extend({name:"comments-timeline",template:n,StreamItem:i,initialize:function(){var e=r.call(arguments);this.model=new s,u.__super__.initialize.apply(this,e)}});return{main:u}}),define("less/app/0.0.1/modules/comment",["../weibo","../lib/oauth2","../util","../message","./tweet-reply","./tweet-modal","./tweet"],function(e){var t='{{#with user}}{{> stream-item-vcard}}{{/with}}<div class="stream-item-content"><div class="tweet"><a href="#!/{{user.id}}" class="username">{{user.screen_name}}</a>: <p>{{ text }}</p><p class="pull-right"><button class="action-reply btn-link" i18n-content="reply">Reply</button><button class="action-del btn-link" i18n-content="delete">Delete</button></p><span class="metadata"><a href="#!/{{user.id}}/{{id}}">{{date_format created_at}}</a><span i18n-content="from">from</span> {{{ source }}}</span></div></div>',n=e("../weibo");return Backbone.Module.extend({name:"comment",className:"stream-item",tagName:"li",template:t,events:{"click .action-reply":"reply","click .action-del":"del"},reply:function(){var t=e("./tweet-reply"),n=new t({model:this.model.clone()});n.show()},del:function(e){var t=this,r=e.currentTarget;if(r.disabled)return;r.disabled=!0,n.request({method:"POST",path:"comments/destroy.json",params:{cid:this.model.get("id")}},function(){r.disabled=!1,t.$el.slideUp(function(){t.destroy()})})}})}),define("less/app/0.0.1/modules/tweet-reply",["./tweet-modal","./tweet","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("./tweet-modal"),r=n.extend({url:"comments/reply.json",initialize:function(){this.model.set({title:chrome.i18n.getMessage("statusReplyTitle",this.model.get("user").name),actions_list:{}}),r.__super__.initialize.apply(this,arguments)},getTextareaQuote:function(){return chrome.i18n.getMessage("reply")+"@"+this.model.get("user").name+":"},getParameters:function(){return{comment:this.getTextareaValue(),cid:this.model.get("cid"),id:this.model.get("id")}}});return r}),define("less/app/0.0.1/modules/tweet-modal",["./tweet","../weibo","../lib/oauth2","../util","../message"],function(e){var t='<div class="modal-header"><button type="button" i18n-values="title:close" class="close" data-dismiss="modal">x</button><h3>{{title}}</h3></div><div class="modal-body"><textarea name="status" class="status-editor fullspace"></textarea><div class="status-actions clearfix"><div class="pull-right"><span class="status-counter">140</span><input type="submit" value="Submit" class="status-submit-btn btn btn-primary" disabled></div><ul class="status-actions-list"><li>{{#module name="weibo-emoticons"}}{{/module}}</li>{{#if actions_list.pic}}<li class="dropdown" id="status-pic-dropdown"><a href="#status-pic-dropdown" class="pic-action" i18n-content="image">Image</a><input type="file" class="status-pic-file visuallyhidden" accept="image/*"><ul class="dropdown-menu" id="status-pic-dropdown-menu"><li><canvas class="status-pic-canvas" width="200"></canvas><div class="actions"><button class="status-pic-del btn-link" i18n-content="delete">Delete</button></div></li></ul></li>{{/if}}{{#if actions_list.geo}}<li><button id="status-geo-control" class="action-geo btn-link" i18n-content="enableGeolocation">Enable Geolocation</button></li>{{/if}}{{#if actions_list.topic}}<li><a href="#" class="topic-action" i18n-content="topic">Topic</a></li>{{/if}}</ul></div></div>',n=e("./tweet"),r=n.extend({name:"tweet-modal",className:"modal hide",id:"status-modal",template:t,initialize:function(){r.__super__.initialize.apply(this,arguments);var e=this;this.$el.on("hidden",function(){e.destroy()}),this.on("connected",function(){e.$el.modal("hide")})},show:function(){this.on("load",function(){this.$el.modal("show")},this),this.render().$el.appendTo("body")},counterCallback:function(e,t){var n=e-t,r=this.el.querySelector(".status-counter");r.textContent=String(-n),r.classList[n>0?"add":"remove"]("danger")}});return r}),define("less/app/0.0.1/modules/tweet",["../weibo","../lib/oauth2","../util","../message"],function(e){var t=e("../weibo"),n=e("../message"),r=Backbone.Module.extend({name:"tweet-base",initialize:function(){this.on("load",function(){this.submitBtn=this.el.querySelector(".status-submit-btn");var e=this.getTextareaQuote&&this.getTextareaQuote()||"";this.trigger("repost",e),this.indicateCounter()},this),this.on("repost",function(e){var t=this.el.querySelector(".status-editor");t.value=e,setTimeout(function(){t.focus()},0)},this),r.__super__.initialize.apply(this,arguments)},events:{"click .status-submit-btn":"connect","keyup .status-editor":"indicateCounter","focus .status-editor":"indicateCounter"},getTextareaValue:function(){var e=this.el.querySelector(".status-editor");return String(e.value).trim()},connect:function(e){e.preventDefault();var r=this.getTextareaValue(),i=this.el.querySelector(".status-editor"),s=this;if(r==="")return i.focus(),n.createMessage({text:chrome.i18n.getMessage("fieldEmpty")});var o=this.getParameters(),u=n.createMessage({text:chrome.i18n.getMessage("loading"),autoHide:!1}),a={method:"POST",path:this.url,params:o};return o.pic&&(a.multi=!0),t.request(a,function(){i.value="",s.trigger("connected"),u.hide(),n.createMessage({text:"Success"})}),!1},indicateCounter:function(){var e=this.getTextareaValue(),t=e.length,n=e.match(/[^\x00-\xff]/g),r=e.length+(n&&n.length)||0;r=Math.ceil(r/2);var i=140;this.submitBtn.disabled=r>0&&r<=140?!1:!0,this.counterCallback&&this.counterCallback(r,i)}});return r}),define("less/app/0.0.1/models/user-comments",["./stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("./stream"),r=Backbone.Collection.extend({model:Backbone.Model,url:"comments/timeline.json",parse:function(e,t){return e.comments},sync:n.prototype.sync});return r}),define("less/app/0.0.1/modules/mentions",["../models/statuses","../models/stream","../weibo","../lib/oauth2","../util","../message","./stream-item","./timeline"],function(e){var t='<div class="stream">{{#each this}}{{#module this name="stream-item"}}{{/module}}{{/each}}</div>',n=e("../models/statuses"),r=e("./stream-item"),i=e("./timeline"),s=n.extend({url:"statuses/mentions.json"}),o=i.extend({name:"mentions",template:t,StreamItem:r,initialize:function(){this.model=new s,o.__super__.initialize.apply(this,arguments)}});return{main:o,args:{data:{}}}}),define("less/app/0.0.1/modules/relationship-action",["../weibo","../lib/oauth2","../util","../message"],function(e,t){var n='<div class="relationship-container {{#if following}} following{{/if}}{{#if follow_me}} follow-me{{/if}}"><a href="#" class="btn btn-primary relationship-btn"><span class="btn-text action-following">Following</span><span class="btn-text action-follow">Follow</span><span class="btn-text action-unfollow">Unfollow</span></a><div class="relationship-mutual">{{#if following}}{{#if follow_me}}相互关注{{/if}}{{/if}}</div></div>',r=e("../weibo"),i=Backbone.Module.extend({name:"relationship-action",template:n,events:{"click .action-unfollow":"unfollow","click .action-follow":"follow"},unfollow:function(e){e.preventDefault(),r.request({method:"POST",path:"friendships/destory.json",params:{uid:this.model.attributes.id}},function(){var t=$(e.currentTarget).parents(".relationship-container");t.removeClass("following")})},follow:function(e){e.preventDefault(),r.request({method:"POST",path:"friendships/create.json",params:{uid:this.model.attributes.id}},function(){var t=$(e.currentTarget).parents(".relationship-container");t.addClass("following")})}});return i}),define("less/app/0.0.1/modules/profile-card",["../models/user","../models/stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n='<div class="flex-module clearfix"><img src="{{avatar_large}}" width="180" height="180" class="avator" alt="{{screen_name}}"><div class="profile-card-inner"><h1>{{screen_name}}</h1>{{#if description}}<p class="bio">{{description}}</p>{{/if}}<p><span class="location">{{location}}</span>{{#if url}}<span class="divider">.</span><a class="url" href={{url}} target="_blank">{{url}}</a>{{/if}}</p></div><div class="profile-card-actions">{{#module this name="relationship-action"}} {{/module}}{{> profile-stats}}</div></div>',r=e("../models/user"),i=Backbone.Module.extend({name:"profile-card",template:n,beforeEnter:function(e){this.options.data.uid=e},initialize:function(){this.model=new r,i.__super__.initialize.apply(this,arguments)}});return{main:i,args:{data:{}}}}),define("less/app/0.0.1/modules/profile-nav",[],function(e){var t='<ul class="nav nav-tabs nav-stacked"><li data-nav="tweets"><a href="#!/{{id}}">Tweets</a></li><li data-nav="following"><a href="#!/{{id}}/following">Following</a></li><li data-nav="followers"><a href="#!/{{id}}/followers">Followers</a></li></ul>',n=Backbone.Module.extend({name:"profile-nav",template:t,initialize:function(){this.on("nav",this._changeNavStatus,this),n.__super__.initialize.apply(this,arguments)},beforeEnter:function(e){this.model.set({id:e})},_changeNavStatus:function(e){var t="active",n=$("li[data-nav="+e+"]",this.$el).addClass(t);n.siblings().removeClass(t)}});return n}),define("less/app/0.0.1/modules/connect-nav",["./profile-nav"],function(e){var t='<ul class="nav nav-tabs nav-stacked"><li data-nav="connect"><a href="#!/connect">Comments</a></li><li data-nav="mentions"><a href="#!/mentions">Mentions</a></li></ul>',n=e("./profile-nav");return n.extend({name:"connect-nav",template:t})}),define("less/app/0.0.1/modules/new-tweet",["./tweet-modal","./tweet","../weibo","../lib/oauth2","../util","../message"],function(e){function i(e,t){var n=new FileReader;n.onload=function(e){var n=new Image;n.onload=function(){t&&t(n)},n.src=e.target.result},n.readAsDataURL(e)}var t=e("./tweet-modal"),n=e("../message"),r=e("../util"),s=Backbone.View.extend({loadFile:function(e,t){var n=this,s;e.size>5242880&&(s=new Error(chrome.i18n.getMessage("fileSizeError")));if(s)return t(s);this.pic=e,i(e,function(e){var i=n.el.querySelector(".status-pic-canvas"),s=i.getContext("2d"),o=200,u=r.scale(e.width,e.height,o,o);i.height=u.height,s.clearRect(0,0,200,200),s.drawImage(e,parseInt((o-u.width)/2),0,u.width,u.height),t(null)})},events:{"click .status-pic-del":"del"},show:function(){this.active=!0,this.$el.show()},del:function(){$(document).trigger("picture:del"),this.$el.hide(),this.pic=null,this.active=!1}}),o=t.extend({events:{"click .action-geo":"_toggleGeo","click .pic-action":"_triggerFileChange","change .status-pic-file":"_loadFile","click .topic-action":"_insertTopic"},initialize:function(){var e=this;_.extend(this.events,o.__super__.events),this.model.set({title:chrome.i18n.getMessage("statusDefaultTitle"),actions_list:{pic:!0,geo:!0,topic:!0}}),this._setType("update"),$(document).on("picture:del",function(){e._setType("update")}),o.__super__.initialize.apply(this,arguments)},render:function(){return o.__super__.render.apply(this,arguments),this.picView=new s({el:this.el.querySelector("#status-pic-dropdown-menu")}),this},_toggleGeo:function(e){e.preventDefault();var t=e.currentTarget,n,r=this;t.checked?(t.textContent=chrome.i18n.getMessage("enableGeolocation"),this.geo=null,t.checked=!1):(navigator.geolocation.getCurrentPosition(function(e){r.geo={lat:e.coords.latitude,"long":e.coords.longitude},t.textContent=chrome.i18n.getMessage("disableGeolocation")}),n="enableGeolocation",t.checked=!0)},_triggerFileChange:function(e){e.preventDefault();if(this.picView.active)return;this.el.querySelector(".status-pic-file").click()},_loadFile:function(e){e.preventDefault();var t=e.currentTarget,r=t.files[0],i=this;if(!r)return;this.submitBtn.disabled=!0;var s=n.createMessage({text:chrome.i18n.getMessage("generatePreview"),autoHide:!1});this._setType("upload"),this.picView.loadFile(r,function(e){i.picView.show(),i.indicateCounter(),s.hide()})},_insertTopic:function(e){e.preventDefault();var t=chrome.i18n.getMessage("topicMessage"),n=this.el.querySelector(".status-editor"),r="#",i=r+t+r,s=n.value,o=s.indexOf(i);if(~o)n.selectionStart=o+1,n.selectionEnd=o+i.length-1;else{var u=n.selectionStart,a=n.selectionEnd;u!=a?(s=s.slice(0,u)+r+s.slice(u,a)+r+s.slice(a),n.value=s,n.selectionStart=u+1,n.selectionEnd=a+1):(s=s.slice(0,u)+i+s.slice(a),n.value=s,n.selectionStart=u+1,n.selectionEnd=u+t.length+1)}n.focus(),this.indicateCounter()},_setType:function(e){this.type=e;var t={update:"statuses/update.json",upload:"statuses/upload.json"};this.url=t[e]},getParameters:function(){var e=_.extend({status:this.getTextareaValue()},this.geo);return this.type=="upload"&&(e.pic=this.picView.pic),e}});return o}),define("less/app/0.0.1/modules/following",["../models/users","../models/stream","../weibo","../lib/oauth2","../util","../message","./timeline","./user"],function(e,t){var n=e("../models/users"),r='<ul class="stream">{{#each this}}{{#module this name="user"}}{{/module}}{{/each}}</ul>',i=e("./timeline"),s=e("./user"),o=n.extend({url:"friendships/friends.json"}),u=i.extend({name:"following",template:r,StreamItem:s,beforeEnter:function(e){this.options.data.uid=e},initialize:function(){this.model=new o,u.__super__.initialize.apply(this,arguments)}});return{main:u,args:{data:{},cursor:"cursor"}}}),define("less/app/0.0.1/models/users",["./stream","../weibo","../lib/oauth2","../util","../message"],function(e,t){var n=e("./stream"),r=Backbone.Collection.extend({model:Backbone.Model,parse:function(e,t){return e.users},sync:n.prototype.sync});return r}),define("less/app/0.0.1/modules/followers",["../models/users","../models/stream","../weibo","../lib/oauth2","../util","../message","./timeline","./user"],function(e,t){var n=e("../models/users"),r='<ul class="stream">{{#each this}}{{#module this name="user"}}{{/module}}{{/each}}</ul>',i=e("./timeline"),s=e("./user"),o=n.extend({url:"friendships/followers.json"}),u=i.extend({name:"followers",template:r,StreamItem:s,beforeEnter:function(e){this.options.data.uid=e},initialize:function(){this.model=new o,u.__super__.initialize.apply(this,arguments)}});return{main:u,args:{data:{},cursor:"cursor"}}}),define("less/app/0.0.1/modules/mini-repost-list",["../models/reposts","../models/stream","../weibo","../lib/oauth2","../util","../message","./mini-repost-body"],function(e){var t='<div class="header"></div><div class="body"></div><footer><div class="nav" hidden><button class="nav-prev btn-link" i18n-content="prev">Prev</a></button><button class="nav-next btn-link" i18n-content="next">Next</a></button></div></nav>',n=Backbone.Module.extend({name:"mini-repost-list",events:{"click .nav-prev":"navPrev","click .nav-next":"navNext"},template:t,initialize:function(){n.__super__.initialize.apply(this,arguments),this.options.data=_.defaults({},this.options.data,{count:10}),this.currentPage=0,this.totalPage=0,this.on("fetch",function(e,t){this.currentPage=e;var n=this.totalPage=Math.ceil(t/this.options.data.count);n>1&&(this.navEl.hidden=!1,this.checkNav())}),this.onReady(function(){this.navEl=this.el.querySelector("footer .nav"),this.initTweetModule(),this.initBody()}),this.on("load",function(){this.delegate("mini-stream-item","repost",function(e){var t=this.options.tweetModuleName;this.getChildModuleByName(t)[0].trigger("repost",e)}.bind(this))},this)},navPrev:function(){this.fetch(this.currentPage-1)},navNext:function(){this.fetch(this.currentPage+1)},checkNav:function(){this.navEl.querySelector(".nav-prev").disabled=this.currentPage==1,this.navEl.querySelector(".nav-next").disabled=this.currentPage==this.totalPage},_disableNav:function(){_.each(this.navEl.querySelectorAll("button"),function(e){e.disabled=!0})},getBodyModule:function(){var t=_.extend({},this.options.data,{page:1,id:this.model.get("id")}),n=e("../models/reposts"),r={model:new n,data:t},i=new(e("./mini-repost-body"))(r);return{main:i,args:["repost"]}},initBody:function(){var e=this.getBodyModule(),t=e.main;this._bodyModuleId=t.id,this.append(t,".body",e.args)},initTweetModule:function(){var e=Backbone.application.getModuleInstance(this.options.tweetModuleName,{model:this.model.clone()});e.on("connected",function(){var e=this.getChildModuleById(this._bodyModuleId);e.fetch(1)},this),this.append(e,".header")},fetch:function(e){this._disableNav();var t=this.getChildModuleById(this._bodyModuleId);t.fetch(e)}});return{main:n,args:{tweetModuleName:"tweet-repost"}}}),define("less/app/0.0.1/models/reposts",["./stream","../weibo","../lib/oauth2","../util","../message"],function(e){var t=e("../models/stream");return t.extend({url:"statuses/repost_timeline.json"})}),define("less/app/0.0.1/modules/mini-repost-body",[],function(e){var t='{{#if reposts.length}}{{#each reposts}}{{#module this name="mini-stream-item"}} {{/module}}{{/each}}{{else}}<p>Empty!</p>{{/if}}',n='<div class="loading-area"><img src="images/loading.gif"><span i18n-content="loading">Loading</span></div>',r=Backbone.Module.extend({name:"mini-repost-body",tagName:"ul",template:t,placeholder:n,initialize:function(){this.onReady(function(){this.parent.trigger("fetch",this.options.data.page,this.model.get("total_number"))}),r.__super__.initialize.apply(this,arguments)},fetch:function(e){this.options.data.page=e,this.refresh("repost")}});return r}),define("less/app/0.0.1/modules/mini-comment-list",["./mini-repost-list","../models/reposts","../models/stream","../weibo","../lib/oauth2","../util","../message","./mini-repost-body","../models/comments","./mini-comment-body"],function(e){var t=e("./mini-repost-list"),n=t.main.extend({name:"mini-comment-list",getBodyModule:function(){var t=_.extend({},this.options.data,{page:1,id:this.model.get("id")}),n=e("../models/comments"),r=e("./mini-comment-body"),i={model:new n,data:t},s=new r(i);return{main:s,args:["reply"]}}});return{main:n,args:{tweetModuleName:"tweet-comment"}}}),define("less/app/0.0.1/models/comments",["./stream","../weibo","../lib/oauth2","../util","../message"],function(e){var t=e("../models/stream"),n=t.extend({url:"comments/show.json"});return n}),define("less/app/0.0.1/modules/mini-comment-body",["./mini-repost-body"],function(e){var t='{{#if comments.length}}{{#each comments}}{{#module this name="mini-stream-item"}} {{/module}}{{/each}}{{else}}<p>Empty!</p>{{/if}}',n=e("./mini-repost-body");return n.extend({name:"mini-comment-body",template:t,fetch:function(e){this.options.data.page=e,this.refresh("reply")}})}),define("less/app/0.0.1/modules/mini-stream-item",["./tweet-reply","./tweet-modal","./tweet","../weibo","../lib/oauth2","../util","../message"],function(e){var t='{{#with user}}{{> stream-item-vcard}}{{/with}}<div class="stream-item-content"><div class="tweet"><a href="#!/{{user.id}}" class="username">{{user.screen_name}}</a>: <p>{{ text }}</p><p>{{#if action_list.reply}}<button class="action-reply btn-link" i18n-content="reply">Reply</button>{{/if}}{{#if action_list.repost}}<button class="action-repost btn-link" i18n-content="repost">Repost</button>{{/if}}</p></div></div>';return Backbone.Module.extend({name:"mini-stream-item",className:"stream-item",tagName:"li",template:t,events:{"click .action-reply":"reply","click .action-repost":"repost"},beforeEnter:function(e){var t={};t[e]=!0,this.model.set("action_list",t)},reply:function(){var t=e("./tweet-reply"),n=new t({model:this.model.clone()});n.show()},repost:function(){var e="//@"+this.model.get("user").name+":"+this.model.get("text");this.trigger("repost",e)}})}),define("less/app/0.0.1/modules/tweet-comment",["./tweet-publisher-inline","./tweet","../weibo","../lib/oauth2","../util","../message","../flex-textarea"],function(e){var t=e("./tweet-publisher-inline"),n=e("../weibo"),r=t.extend({name:"tweet-comment",url:"comments/create.json",beforeEnter:function(){this.model.set({repost:chrome.i18n.getMessage("repostToMyTimeline")}),this.model.get("retweeted_status")&&this.model.set({comment_ori:!0,ori_username:chrome.i18n.getMessage("commentToOrigin",this.model.get("retweeted_status").user.name)})},getParameters:function(){var e=this.el.querySelector(".js-commentOrigin"),t=e&&e.checked,n=this.getTextareaValue(),r={id:this.model.get("id")};return this.el.querySelector(".js-repost").checked?(this.url="statuses/repost.json",r.status=n,r.is_comment=t?2:1):(this.url="comments/create.json",r.comment=n,t&&(r.comment_ori=t?1:0)),r}});return r}),define("less/app/0.0.1/modules/tweet-publisher-inline",["./tweet","../weibo","../lib/oauth2","../util","../message","../flex-textarea"],function(e){var t=e("./tweet"),n='<form class="form-inline"><textarea name="status" class="status-editor"></textarea><input type="submit" value="Submit" class="status-submit-btn btn btn-primary" disabled></form><div class="status-actions clearfix"><ul class="status-actions-list"><li>{{#module name="weibo-emoticons"}}{{/module}}</li></ul></div><ul class="status-aside">{{#if comment}}<li><label><input type="checkbox" name="comment" class="js-comment">{{comment}}</label></li>{{/if}}{{#if repost}}<li><label><input type="checkbox" name="repost" class="js-repost">{{repost}}</label></li>{{/if}}{{#if comment_ori}}<li><label><input type="checkbox" name="commentOrigin" class="js-commentOrigin">{{ori_username}}</label></li>{{/if}}</ul>',r=e("../flex-textarea"),i=t.extend({className:"tweet-publisher-inline",template:n,initialize:function(){this.on("load",function(){this.flexInstance=r(this.el.querySelector("textarea"))},this),i.__super__.initialize.apply(this,arguments)},destroy:function(){this.flexInstance.destroy(),i.__super__.destroy.apply(this,arguments)}});return i}),define("less/app/0.0.1/flex-textarea",[],function(e,t,n){function s(e){function r(e){var t=["font-size","line-height","width"];t.forEach(function(t){i.css(t,e.css(t))}),setTimeout(function(){s(e.val())},0)}function s(e){i.height("auto").text(""),i.text(e||this.value),t.height(Math.max(i.height(),parseInt(t.css("line-height"))))}var t=$(e),n="keyup.flexTextarea";return t.on(n,s),r(t),{destroy:function(){t.off(n)}}}n.exports=s;var r='<div id="flex-textarea"></div>',i=$(r).appendTo("body");i.css({visibility:"hidden",position:"fixed"})}),define("less/app/0.0.1/modules/tweet-repost",["./tweet-publisher-inline","./tweet","../weibo","../lib/oauth2","../util","../message","../flex-textarea"],function(e){var t=e("./tweet-publisher-inline"),n=t.extend({name:"tweet-repost",url:"statuses/repost.json",beforeEnter:function(){this.model.get("retweeted_status")&&this.model.set({comment_ori:!0,ori_username:chrome.i18n.getMessage("commentToOrigin",this.model.get("retweeted_status").user.name)}),this.model.set({comment:chrome.i18n.getMessage("commentTo",this.model.get("user").name)})},getTextareaQuote:function(){return"//@"+this.model.get("user").name+":"+this.model.get("text")},getParameters:function(){var e={id:this.model.get("id"),status:this.getTextareaValue()},t=0;return this.el.querySelector(".js-comment").checked&&t++,this.el.querySelector(".js-commentOrigin")&&this.el.querySelector(".js-commentOrigin").checked&&t++,e.is_comment=t,e}});return n}),define("less/app/0.0.1/view_states/index",[],function(e,t){var n='<div class="container"><div class="row"><div class="dashboard span4"> {{#module name="mini-profile"}} {{/module}}</div><div class="content-main span8"> {{#module name="home-timeline"}} {{/module}}</div></div></div>';return function(t,r){var i=Backbone.ViewState.extend({name:"index",path:"",template:n,el:t.el});r.register(i)}}),define("less/app/0.0.1/view_states/status",[],function(e,t){var n='<div class="container">{{#module name="status"}}{{/module}}</div>';return function(t,r){var i=Backbone.ViewState.extend({name:"vs-status",path:"!/:userId/:statusId*type",el:t.el,template:n});r.register(i)}}),define("less/app/0.0.1/view_states/profile",[],function(e,t){return function(t,n){var r='<div class="container">{{#module name="profile-card"}} {{/module}}<div class="row standard-page-body"><div class="dashboard span4">{{#module name="profile-nav"}} {{/module}}</div><div class="content-main span8"></div></div></div>',i=Array.prototype.slice,s,o=Backbone.ViewState.extend({name:"profile",path:"!/:uid",template:r,el:t.el,enter:function(){if(!this.isActive())return;s=this.getChildModuleByName("profile-nav")[0],s.onReady(function(){this.trigger("nav","tweets")});var e=i.call(arguments),n=t.getModuleInstance("user-timeline");this.append(n,".content-main",e)},transition:function(){this.getChildModuleByName("user-timeline")[0].destroy()}});n.register(o);var u=Backbone.ViewState.extend({name:"profile-following",path:"!/:uid/following",el:t.el,enter:function(){this.parent.delegateReady("profile-nav",function(){this.trigger("nav","following")});var e=i.call(arguments),n=t.getModuleInstance("following");this.append(n,".content-main",e)},transition:function(){this.getChildModuleByName("following")[0].destroy()}});n.registerSubViewState(u,o);var a=Backbone.ViewState.extend({name:"profile-followers",path:"!/:uid/followers",el:t.el,enter:function(){this.parent.delegateReady("profile-nav",function(){this.trigger("nav","followers")});var e=i.call(arguments),n=t.getModuleInstance("followers");this.append(n,".content-main",e)},transition:function(){this.getChildModuleByName("followers")[0].destroy()}});n.registerSubViewState(a,o)}}),define("less/app/0.0.1/view_states/connect",[],function(e,t){var n='<div class="container"><div class="row"><div class="dashboard span4"> {{#module name="connect-nav"}} {{/module}}</div><div class="content-main span8"> </div></div></div>',r=Array.prototype.slice;return function(t,i){var s=Backbone.ViewState.extend({name:"connect",path:"!/connect",template:n,el:t.el,enter:function(){if(!this.isActive())return;profileNav=this.getChildModuleByName("connect-nav")[0],profileNav.onReady(function(){this.trigger("nav","connect")});var e=t.getModuleInstance("comments-timeline"),n=[JSON.parse(localStorage.getItem("uid"))];this.append(e,".content-main",n)},transition:function(){this.getChildModuleByName("comments-timeline")[0].destroy()}});i.register(s);var o=Backbone.ViewState.extend({name:"vs-mentions",path:"!/mentions",el:t.el,enter:function(){this.parent.delegateReady("connect-nav",function(){this.trigger("nav","mentions")});var e=r.call(arguments),n=t.getModuleInstance("mentions");this.append(n,".content-main",e)},transition:function(){this.getChildModuleByName("mentions")[0].destroy()}});i.registerSubViewState(o,s)}}),define("less/app/0.0.1/init",["./lib/oauth2","./util","./tweet_plugin","./modules/mini_profile","./models/signed-user","./models/user","./models/stream","./weibo","./message","./modules/weibo-emoticons","./modules/stream-picture","./modules/stream-item","./modules/user","./modules/home-timeline","./reminder","./models/statuses","./modules/timeline","./modules/status","./modules/stream","./modules/user-timeline","./modules/comments","./modules/comment","./modules/tweet-reply","./modules/tweet-modal","./modules/tweet","./models/user-comments","./modules/mentions","./modules/relationship-action","./modules/profile-card","./modules/profile-nav","./modules/connect-nav","./modules/new-tweet","./modules/following","./models/users","./modules/followers","./modules/mini-repost-list","./models/reposts","./modules/mini-repost-body","./modules/mini-comment-list","./models/comments","./modules/mini-comment-body","./modules/mini-stream-item","./modules/tweet-comment","./modules/tweet-publisher-inline","./flex-textarea","./modules/tweet-repost","./view_states/index","./view_states/status","./view_states/profile","./view_states/connect"],function(e,t){var n=e("./lib/oauth2").getInstance(),r=e("./util"),i=e("./tweet_plugin");n.hasToken()||(window.location.href=chrome.extension.getURL("login.html")),Backbone.install({el:"#main"},function(t,n){var s=Backbone.Module.prototype.render;Backbone.Module.prototype.render=function(){return s.apply(this,arguments),i18nTemplate.process(this.el,chrome.i18n.getMessage),this},Handlebars.registerHelper("date_format",r.dateFormat),Handlebars.registerHelper("tweet_plugins_process",i.process),Handlebars.registerPartial("stream-item-vcard",'<div class="stream-item-vcard"><a class="vcard" title="{{ name }}" href="#!/{{ id }}"><img width="50" height="50" src="{{ profile_image_url }}" class="avator"></a></div>'),Handlebars.registerPartial("stream-item-tweet-content",'<a href="#!/{{user.id}}" class="username">{{user.screen_name}}</a>: <p>{{#tweet_plugins_process text}}{{/tweet_plugins_process}}</p>{{#if thumbnail_pic}}{{#module this name="stream-picture"}}{{/module}}{{/if}}'),Handlebars.registerPartial("stream-item-footer",'<div class="stream-item-footer{{#if action_fav}} stream-item-primary-footer{{/if}}"><span class="metadata"><a href="#!/{{user.id}}/{{id}}">{{date_format created_at}}</a><span i18n-content="from">from</span> {{{ source }}}</span><ul class="actions">{{#if action_del}}<a href="#" title="Delete" class="action-del" i18n-values="title:delete"><span class="icon icon-16 icon-del"></span></a>{{/if}}{{#if action_fav}}<li>{{! FIXME: favorited is aways false }}<a href="#" title="Favorite" class="action-favorite{{#if favorited}} favorited{{/if}}" i18n-values="title:favorite"><span class="icon icon-16 icon-favorite"></span></a></li>{{/if}}<li><a href="#!/{{user.id}}/{{id}}/repost" title="Repost" class="action-repost" i18n-values="title:repost"><span class="icon icon-16 icon-repost"></span>{{ reposts_count }}</a></li><li><a href="#!/{{user.id}}/{{id}}/comment" title="Comment" class="action-comment" i18n-values="title:comment"><span class="icon icon-16 icon-comment"></span>{{ comments_count }}</a></li></ul></div>'),Handlebars.registerPartial("profile-stats",'<ul class="profile-stats"><li><a href="#!/{{id}}"><strong>{{statuses_count}}</strong>TWEETS</a></li><li><a href="#!/{{id}}/following"><strong>{{friends_count}}</strong>FOLLOWING</a></li><li><a href="#!/{{id}}/followers"><strong>{{followers_count}}</strong>FOLLOWERS</a></li></ul>'),Handlebars.registerPartial("stream-item-profile-content",'<div class="stream-item-content"><div class="actions"> {{#module this name="relationship-action"}} {{/module}}</div><div class="content"><a href="#!/{{id}}" class="username">{{screen_name}}</a><p class="bio">{{description}}</p></div></div>'),t.registerModule(e("./modules/mini_profile")),t.registerModule(e("./modules/weibo-emoticons")),t.registerModule(e("./modules/stream-picture")),t.registerModule(e("./modules/stream-item")),t.registerModule(e("./modules/user")),t.registerModule(e("./modules/home-timeline")),t.registerModule(e("./modules/status")),t.registerModule(e("./modules/stream")),t.registerModule(e("./modules/user-timeline")),t.registerModule(e("./modules/comments")),t.registerModule(e("./modules/comment")),t.registerModule(e("./modules/mentions")),t.registerModule(e("./modules/relationship-action")),t.registerModule(e("./modules/profile-card")),t.registerModule(e("./modules/profile-nav")),t.registerModule(e("./modules/connect-nav")),t.registerModule(e("./modules/new-tweet")),t.registerModule(e("./modules/following")),t.registerModule(e("./modules/followers")),t.registerModule(e("./modules/mini-repost-list")),t.registerModule(e("./modules/mini-comment-list")),t.registerModule(e("./modules/mini-repost-body")),t.registerModule(e("./modules/mini-comment-body")),t.registerModule(e("./modules/mini-stream-item")),t.registerModule(e("./modules/tweet-comment")),t.registerModule(e("./modules/tweet-repost")),e("./view_states/index")(t,n),e("./view_states/status")(t,n),e("./view_states/profile")(t,n),e("./view_states/connect")(t,n);var o=e("./reminder"),u;o.on("all",function(t,n){if(t=="status")return;if(!u){u=JSON.parse(localStorage.getItem("user"));if(!u)return}var r={follower:u.id+"/followers",cmt:"connect",mention_status:"mentions",mention_cmt:"mentions"},i=r[t];i=i?"#!/"+i:"#";var s=chrome.i18n.getMessage("remind_"+t),o=webkitNotifications.createNotification(u.profile_image_url,u.name,chrome.i18n.getMessage("unreadMessage",[n,s]));o.onclick=function(){window.location.hash=i},o.show()}),$("#global-new-tweet-button").click(function(t){t.stopPropagation();var n=e("./modules/new-tweet"),r=Backbone.Model.extend({url:null}),i=new n({model:new r});i.show()}),n.on("nav",function(e){var t=$("#global-actions"),n=$("li",t),r=n.filter('[data-nav="'+e+'"]');n.removeClass("active"),r.length>0&&r.addClass("active")}),Backbone.history.start(),Backbone.history.checkUrl(),$("#loading-mask").fadeOut()})});