define("less/app/1.0.0/init",["./lib/oauth2","./util","./tweet_plugin","./views/stream_item_vcard.tpl","./views/stream-item-content.tpl","./views/stream-item-footer.tpl","./views/profile-stats.tpl","./views/stream-item-profile-content.tpl","./view_states/index","./views/index.tpl","./modules/mini_profile","./views/mini_profile.tpl","./models/signed-user","./models/user","./models/weibo","./weibo","./message","./modules/home-timeline","./reminder","./views/home-timeline.tpl","./modules/stream-item","./views/stream-item.tpl","./modules/mini-repost-list","./views/mini-repost-list.tpl","./modules/tweet-repost","./modules/tweet-publisher-inline","./modules/tweet","./views/tweet-comment.tpl","./modules/mini-repost-body","./views/mini-repost-body.tpl","./views/loading.tpl","./modules/mini-stream-item","./views/mini-stream-item.tpl","./modules/tweet-reply","./modules/tweet-modal","./views/tweet-modal.tpl","./modules/weibo-emoticons","./views/weibo-emoticons.tpl","./views/weibo-emoticons-body.tpl","./views/weibo-emoticons-nav.tpl","./models/reposts","./models/stream","./modules/mini-comment-list","./modules/tweet-comment","./modules/mini-comment-body","./views/mini-comment-body.tpl","./models/comments","./modules/stream-picture","./views/stream-picture.tpl","./models/statuses","./modules/timeline","./views/timeline.tpl","./view_states/profile","./views/profile.tpl","./modules/profile-nav","./views/profile-nav.tpl","./modules/profile-card","./views/profile-card.tpl","./modules/following","./models/users","./models/cursor","./views/users.tpl","./modules/user","./views/user.tpl","./modules/relationship-action","./views/relationship-action.tpl","./modules/followers","./modules/user-timeline","./views/user-timeline.tpl","./view_states/connect","./views/connect.tpl","./modules/connect-nav","./views/connect-nav.tpl","./modules/comments","./views/comments-timeline.tpl","./modules/comment","./views/comment.tpl","./models/user-comments","./modules/mentions","./modules/new-tweet"],function(a){var b=a("./lib/oauth2").getInstance(),c=a("./util"),d=a("./tweet_plugin");b.hasToken()||(window.location.href=chrome.extension.getURL("login.html"));var e=new Backbone.Router;Backbone.install({el:"#main"},function(b){var f=Backbone.Module.prototype.__render;Backbone.Module.prototype.__render=function(){return f.apply(this,arguments),i18nTemplate.process(this.el,chrome.i18n.getMessage),this},Handlebars.registerHelper("date_format",c.dateFormat),Handlebars.registerHelper("tweet_plugins_process",d.process),Handlebars.registerPartial("stream-item-vcard",a("./views/stream_item_vcard.tpl")),Handlebars.registerPartial("stream-item-tweet-content",a("./views/stream-item-content.tpl")),Handlebars.registerPartial("stream-item-footer",a("./views/stream-item-footer.tpl")),Handlebars.registerPartial("profile-stats",a("./views/profile-stats.tpl")),Handlebars.registerPartial("stream-item-profile-content",a("./views/stream-item-profile-content.tpl")),a("./view_states/index")(b,e),a("./view_states/profile")(b,e),a("./view_states/connect")(b,e);var g,h=a("./reminder");h.on("all",function(a,b){if("status"!=a&&(g||(g=JSON.parse(localStorage.getItem("user"))))){var c={follower:g.id+"/followers",cmt:"connect",mention_status:"mentions",mention_cmt:"mentions"},d=c[a];d=d?"#!/"+d:"#";var e=chrome.i18n.getMessage("remind_"+a),f=webkitNotifications.createNotification(g.profile_image_url,g.name,chrome.i18n.getMessage("unreadMessage",[b,e]));f.onclick=function(){window.location.hash=d},f.show()}}),$("body").on("click","#global-new-tweet-button",function(b){b.stopPropagation();var c=a("./modules/new-tweet"),d=new c;d.show()}),$("#loading-mask").fadeOut()})}),define("less/app/1.0.0/lib/oauth2",["less/app/1.0.0/util"],function(a){function b(a,b,c){this.client_id=a,this.request_url=b,this.redirect_url=c,this.key_token="oauth2_token"}function c(a,b,c,d){c=c||{},this.multi=d,d&&(this.pic=c.pic,delete c.pic),this.method=a.toUpperCase(),this.url=b,this.params=c,this._nonce_chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}var d=a("less/app/1.0.0/util"),e=b.prototype;return e.hasToken=function(){return!!this.getToken()},e.getToken=function(){return this.token||localStorage[this.key_token]},e.setToken=function(a){this.token=a,localStorage[this.key_token]=a},e.clearToken=function(){delete this.token,delete localStorage[this.key_token]},e.getAccessURL=function(){var a=this.request_url,b={client_id:this.client_id,redirect_uri:this.redirect_url,response_type:"token"};return d.addURLParam(a,b)},e.request=function(a,b,d,e,f){f=arguments[arguments.length-1],"boolean"!=typeof e&&(e=!1),"function"==typeof d&&(f=d,d={});var g=new c(a,b,d,e),h=g.generate();this.hasToken()&&(h.headers.Authorization="OAuth2 "+this.getToken()),this.sendRequest(a,h.signed_url,h.headers,h.body,function(a,b){f(a,b)})},e.get=function(){var a=["GET"].concat(arguments);this.request.apply(this,a)},e.post=function(){var a=["POST"].concat(arguments);this.request.apply(this,a)},e.sendRequest=function(a,b,c,d,e){var f=new XMLHttpRequest;if(f.onreadystatechange=function(){4==this.readyState&&e(JSON.parse(this.responseText),this)},f.open(a,b,!0),c)for(var g in c)c.hasOwnProperty(g)&&f.setRequestHeader(g,c[g]);return f.send(d),f},e=c.prototype,e.generate=function(){return{body:this.getBody(),signed_url:this.getSingedURL(),headers:this.getHeaders()}},e.getHeaders=function(){var a={};return a["Content-Type"]=this.multi?"multipart/form-data; boundary="+this.boundary:"application/x-www-form-urlencoded",a},e.getSingedURL=function(){var a=this.url;return"GET"==this.method&&(a=d.addURLParam(a,this.params)),this.signed_url=a,a},e.getBody=function(){if("GET"==this.method)return null;var a;if(this.multi){this.getUniqueBoundary();var b=this.boundary,c="\r\n",e="--",f=this.pic,g="",h="";g=e+b+c;for(var i in this.params)g+='Content-Disposition: form-data; name="'+i+'"'+c+c,g+=this.params[i]+c,g+=e,g+=b,g+=c;g+='Content-Disposition: form-data; name="pic"; filename="'+f.fileName+'"'+c,g+="Content-Type: "+f.fileType+c+c,h=c,h+=e,h+=b,h+=e,h+=c,a=new Blob([g,f,h],{type:"application/octet-binary"})}else a=d.stringify(this.params);return a},e.getUniqueBoundary=function(){for(var a="",b=10,c=this._nonce_chars.length,d=0;b>d;d++){var e=Math.floor(Math.random()*c);a+=this._nonce_chars.substring(e,e+1)}return this.boundary="----boundary"+a,this},app.addSingletonGetter(b),b}),define("less/app/1.0.0/util",[],function(){function a(a,c){c=void 0===c?"&":c;for(var d,e=a.split(c),f={},g=0;d=e[g];g++){var h=d.split("=");if(2==h.length){var i=b(h[0]),j=b(h[1]);f[i]=j}}return f}function b(a){var b=a.replace(/%21/g,"!").replace(/%2A/g,"*").replace(/%27/g,"'").replace(/%28/g,"(").replace(/%29/g,")");return decodeURIComponent(b)}function c(a){return encodeURIComponent(a).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}function d(a,b,d){if("object"!=typeof b){var f=a.indexOf("?")>=0?"&":"?";return a+f+c(b)+"="+c(d)}var h=b;return g(h)?a:a+"?"+e(h)}function e(a){var b="";for(var d in a)b+=c(d)+"="+c(a[d])+"&";return b.slice(0,-1)}function f(a){if(null==a||"object"!=typeof a)return a;if(a instanceof Date){var b=new Date;return b.setTime(a.getTime()),b}if(a instanceof Array){for(var b=[],c=0,d=a.length;d>c;++c)b[c]=f(a[c]);return b}if(a instanceof Object){var b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=f(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")}function g(a){for(var b in a)return!1;return!0}function h(){var b;return(b=window.location.search)?(b=b.slice(1),a(b)):{}}function i(){var b;return(b=window.location.hash)?(b=b.slice(1),a(b)):{}}function j(a){return a=""+a,a=a.toString().replace(o,"&amp;"),a=a.replace(p,"&lt;"),a=a.replace(q,"&gt;"),a=a.replace(r,"&quot;"),a=a.replace(s,"&#39;")}function k(a){return a=""+a,a=a.toString().replace(t,">"),a=a.replace(u,"<"),a=a.replace(v,'"'),a=a.replace(v,'"'),a=a.replace(w,"'")}function l(a,b){var c=document.createElement("link");c.rel="stylesheet",c.href=a,b&&(c.id=b),document.head.appendChild(c)}function m(a,b,c,d){var e=0;return c&&(e=Math.max(e,a/c)),d&&(e=Math.max(e,b/d)),e>1&&(a=parseInt(a/e),b=parseInt(b/e)),{width:a,height:b}}function n(a){a=new Date(a);var b,c=a.getTime(),d=(new Date).getTime()-c,e=1e3,f=6e4,g=60*f,h=24*g,i={days:h,hours:g,minutes:f,seconds:e},j=d/h;if(j>5)b=[a.getFullYear(),a.getMonth()+1,a.getDate()].join("-")+" "+a.toLocaleTimeString();else for(var k in i)if(j=d/i[k],j>1){b=Math.round(j)+" "+chrome.i18n.getMessage(k)+" "+chrome.i18n.getMessage("ago");break}return b}var o=/&/g,p=/</g,q=/>/g,r=/"/g,s=/'/g,t=/\&gt\;/g,u=/\&lt\;/g,v=/\&quot\;/g,w=/\&#39\;/g;return{clone:f,formDecode:a,toRfc3986:c,fromRfc3986:b,addURLParam:d,stringify:e,parseQueryString:h,parseHashString:i,htmlDecode:k,htmlEncode:j,html:j,loadStyle:l,scale:m,dateFormat:n}}),define("less/app/1.0.0/tweet_plugin",["less/app/1.0.0/util"],function(a){var b,c=a("less/app/1.0.0/util"),d=[function(a){return a.replace(/\b(http:\/\/[\w\.\/]+)/g,function(a,b){return'<a target="_blank" href="'+b+'">'+b+"</a>"})},function(a){return a.replace(/#([^\#]*?)#/g,function(a,b){return'<a target="_blank" href="http://weibo.com/k/'+c.fromRfc3986(b)+'">'+a+"</a>"})},function(a){return b?a.replace(/\[([^\]]*?)\]/g,function(a,c){var d=b[a];return d?'<img src="'+d+'" title="'+c+'" alt="'+a+'">':a}):a},function(a){return a.replace(/@([\u4e00-\u9fa5\w-]+)/g,function(a,b){return'<a class="name" href="#!/'+b+'">@'+b+"</a>"})}];return{process:function(a){return d.reduce(function(a,b){return b(a)},a)}}}),define("less/app/1.0.0/views/stream_item_vcard.tpl",[],'<div class="stream-item-vcard">\n    <a class="vcard" title="{{ name }}" href="#u/{{ id }}">\n        <img width="50" height="50" src="{{ profile_image_url }}" class="avator">\n    </a>\n</div>'),define("less/app/1.0.0/views/stream-item-content.tpl",[],'<a href="#u/{{user.id}}" class="username">{{user.screen_name}}</a>: <p>{{#tweet_plugins_process text}}{{/tweet_plugins_process}}</p>\n<div class="thumbnail_pic-container"></div>'),define("less/app/1.0.0/views/stream-item-footer.tpl",[],'<div class="stream-item-footer {{#if primary}}stream-item-primary-footer{{else}}stream-item-footer-retweet{{/if}}">\n    <span class="metadata">\n        <a href="#!/{{user.id}}/{{id}}">{{date_format created_at}}</a>\n        <span i18n-content="from">from</span> {{{ source }}}\n    </span>\n    <ul class="actions">\n        {{#if primary}}\n            {{#if action_del}}\n                <li>\n                    <a href="#" title="Delete" class="action-del" i18n-values="title:delete">\n                        <span class="icon icon-16 icon-del"></span>\n                    </a>\n                </li>\n            {{/if}}\n            <li>{{! FIXME: favorited is aways false }}\n                    <a href="#" title="Favorite" class="action-favorite{{#if favorited}} favorited{{/if}}" i18n-values="title:favorite">\n                            <span class="icon icon-16 icon-favorite"></span>\n                    </a>\n            </li>\n        {{/if}}\n        <li>\n            <a href="{{#if primary}}#!/{{user.id}}/{{id}}/repost{{else}}#{{/if}}"{{#unless primary}} target="_blank"{{/unless}} title="Repost" class="action-repost" i18n-values="title:repost">\n                <span class="icon icon-16 icon-repost"></span>\n                {{ reposts_count }}\n            </a>\n        </li>\n        <li>\n            <a href="{{#if primary}}#!/{{user.id}}/{{id}}/comment{{else}}#{{/if}}"{{#unless primary}} target="_blank"{{/unless}} title="Comment" class="action-comment" i18n-values="title:comment">\n                <span class="icon icon-16 icon-comment"></span>\n                {{ comments_count }}\n            </a>\n        </li>\n    </ul>\n</div>\n'),define("less/app/1.0.0/views/profile-stats.tpl",[],'<ul class="profile-stats">\n    <li><a href="#u/{{id}}"><strong>{{statuses_count}}</strong>TWEETS</a></li>\n    <li><a href="#u/{{id}}/following"><strong>{{friends_count}}</strong>FOLLOWING</a></li>\n    <li><a href="#u/{{id}}/followers"><strong>{{followers_count}}</strong>FOLLOWERS</a></li>\n</ul>'),define("less/app/1.0.0/views/stream-item-profile-content.tpl",[],'<div class="stream-item-content">\n    <div class="actions"> {{#module this name="relationship-action"}} {{/module}}</div>\n    <div class="content">\n        <a href="#!/{{id}}" class="username">{{screen_name}}</a>\n        <p class="bio">{{description}}</p>\n    </div>\n</div>\n'),define("less/app/1.0.0/view_states/index",["less/app/1.0.0/modules/mini_profile","less/app/1.0.0/models/signed-user","less/app/1.0.0/models/user","less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/home-timeline","less/app/1.0.0/reminder","less/app/1.0.0/modules/stream-item","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture","less/app/1.0.0/models/statuses","less/app/1.0.0/modules/timeline"],function(a){var b=a("less/app/1.0.0/views/index.tpl"),c=a("less/app/1.0.0/modules/mini_profile"),d=a("less/app/1.0.0/modules/home-timeline");return function(a){var e=Backbone.Module.extend({name:"index",__parseParent:function(){return a.el},render:function(){return this.$el.html(b),this.append(c,".dashboard",[{uid:localStorage.uid}]),this.append(d,".content-main"),this}});a.register("",e)}}),define("less/app/1.0.0/views/index.tpl",[],'<div class="container">\n    <div class="row">\n        <div class="dashboard span4"> </div>\n        <div class="content-main span8"> </div>\n    </div>\n</div>\n'),define("less/app/1.0.0/modules/mini_profile",["less/app/1.0.0/models/signed-user","less/app/1.0.0/models/user","less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/views/mini_profile.tpl"),c=a("less/app/1.0.0/models/signed-user"),d=Backbone.Module.extend({name:"mini-profile",className:"module",placeholder:"Loading..",template:b,initialize:function(){this.model=new c,this.options={},this.options.data={uid:localStorage.getItem("uid")},d.__super__.initialize.apply(this,arguments)}});return d}),define("less/app/1.0.0/views/mini_profile.tpl",[],'<div class="flex-module">\n    <div class="profile-summary"><a href="#u/{{id}}">\n        <div class="content"><img src="{{profile_image_url}}" class="avatar"> <b class="fullname">{{screen_name}}</b>\n            <small class="meta">View my profile page</small>\n        </div>\n    </a></div>\n</div>\n<div class="flex-module">{{> profile-stats}}</div>'),define("less/app/1.0.0/models/signed-user",["less/app/1.0.0/models/user","less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/user");return b.extend({storeID:"user"})}),define("less/app/1.0.0/models/user",["less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/weibo");return b.extend({url:"users/show.json"})}),define("less/app/1.0.0/models/weibo",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/weibo"),c={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};return Backbone.Model.extend({sync:function(a,d,e){var f={path:d.url,method:c[a],params:e.data};if(_.isString(d.storeID)){var g=e.success;if("read"==a){var h=localStorage.getItem(d.storeID);if(h)return h=JSON.parse(h),g(h)}e.success=function(a,b,c){localStorage.setItem(d.storeID,JSON.stringify(a)),g(a,b,c)}}b.request(f,{success:e.success,error:e.error})}})}),define("less/app/1.0.0/weibo",["less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){function b(a,d){var e=a.base_url||"https://api.weibo.com/2/",f=e+a.path,g=a.method||"GET",h=a.multi||!1;c.request(g,f,a.params,h,function(a,c){if(a.error_code&&a.error_code<=21332&&a.error_code>=21322)return window.location.href=chrome.extension.getURL("login.html"),void 0;var e="object"==typeof d,f=e&&d.error?d.error:b.errorHandler,g=e?d.success:d;200==c.status?g(a,c.status,c):f(a,c)})}var c=a("less/app/1.0.0/lib/oauth2").getInstance(),d=a("less/app/1.0.0/message");return window.errorHandler=b.errorHandler=function(a){d.createMessage({text:a.error,actions:[{label:"Ok",click:function(){this.hide()}}],className:"error"})},{request:b}}),define("less/app/1.0.0/message",[],function(){var a=function(){this.initialize.apply(this,arguments)};return a.prototype={constructor:a,initialize:function(b){var b=$.extend({},a.defaults,b),c=this;this.option(b);var d=this.$el=$('<div class="message"><div class="message-inner"><span class="message-text">'+b.text+"</span></div></div>");if(b.actions){var e=$('<div class="message-actions" />');b.actions.forEach(function(a){var b=$('<button class="btn-link">'+a.label+"</button>");b.click(_.bind(a.click,c)),e.append(b)}),d.find(".message-inner").append(e)}"string"==typeof b.className&&d.addClass(this.options.className),_.bindAll(this,"hide"),this.option("autoOpen")&&this.show()},show:function(){this.$el.appendTo("body"),this.option("autoHide")&&this.addTimer()},hide:function(){this.$el.remove()},addTimer:function(){this.timer=window.setTimeout(this.hide,this.option("hideTimeout"))},clearTimer:function(){this.timer&&window.clearTimeout(this.timer)}},_.extend(a.prototype,app.Options),a.defaults={hideTimeout:4e3,autoOpen:!0,autoHide:!0},{createMessage:function(b){return new a(b)}}}),define("less/app/1.0.0/modules/home-timeline",["less/app/1.0.0/reminder","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/stream-item","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture","less/app/1.0.0/models/statuses","less/app/1.0.0/modules/timeline"],function(a){var b=a("less/app/1.0.0/reminder"),c=a("less/app/1.0.0/views/home-timeline.tpl");Array.prototype.slice;var d=a("less/app/1.0.0/modules/stream-item"),e=a("less/app/1.0.0/models/statuses"),f=a("less/app/1.0.0/modules/timeline"),g=f.extend({name:"home-timeline",template:c,events:{"click .status-unread-count":"_renderUnread"},initialize:function(){b.on("status",this._handleUnread,this),this.__item=d,this.collection=new e,g.__super__.initialize.apply(this,arguments)},render:function(){return this.$el.html(c),this.collection.fetch({success:function(){}}),this.$unreadCount=this.$el.find(".status-unread-count"),this},_handleUnread:function(a){this.$unreadCount.text("有 "+a+" 条新微博，点击查看").show()},_renderUnread:function(){this.$unreadCount.hide(),this.fetch({data:{since_id:this.collection.first().id},position:"prepend"})},destroy:function(){b.off("status",this._handleUnread,this),g.__super__.destroy.apply(this,arguments)}});return g}),define("less/app/1.0.0/reminder",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){function b(){d.request({base_url:"https://rm.api.weibo.com/2/",path:"remind/unread_count.json"},{success:function(a){var b,c;for(b in a)c=a[b],c&&e.trigger(b,c)},failure:function(){self.pollingInterval*=2}})}var c=12e4,d=a("less/app/1.0.0/weibo");setInterval(function(){chrome.idle.queryState(30,function(a){var c="active"==a;c&&!document.webkitHidden&&b()})},c);var e=function(){};return _.extend(e,Backbone.Events),e}),define("less/app/1.0.0/views/home-timeline.tpl",[],'<div class="status-unread-count hide"></div>\n<div class="stream"></div>'),define("less/app/1.0.0/modules/stream-item",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture"],function(a){var b=a("less/app/1.0.0/weibo"),c=a("less/app/1.0.0/views/stream-item.tpl"),d=JSON.parse(localStorage.getItem("uid")),e=a("less/app/1.0.0/modules/mini-repost-list"),f=a("less/app/1.0.0/modules/mini-comment-list"),g=a("less/app/1.0.0/modules/stream-picture"),h=Backbone.Module.extend({name:"stream-item",className:"stream-item",template:c,events:{"click .stream-item-primary-footer .action-repost":"repost","click .stream-item-primary-footer .action-comment":"comment","click .stream-item-primary-footer .action-favorite":"favorite","click .stream-item-primary-footer .action-del":"del","click .stream-item-footer-retweet .action-repost":"viewRetweetRepost","click .stream-item-footer-retweet .action-comment":"viewRetweetComment"},initialize:function(){d==this.model.get("user").id&&this.model.set({action_del:!0}),this.model.set({primary:!0}),h.__super__.initialize.apply(this,arguments)},__getRetweetMid:function(){var a=$.Deferred();return b.request({path:"statuses/querymid.json",params:{type:1,id:this.model.get("retweeted_status").id}},{success:function(b){a.resolveWith(this,[b.mid])}}),a},__viewRetweet:function(a){var b=this;if("undefined"==typeof this.__retweetedMid){a.preventDefault();var c=a.target;this.__getRetweetMid().done(function(a){b.__retweetedMid=a,c.href="http://weibo.com/"+b.model.get("retweeted_status").user.id+"/"+b.__retweetedMid,c.click()})}},viewRetweetComment:function(a){this.__viewRetweet(a,"comment")},viewRetweetRepost:function(a){this.__viewRetweet(a,"repost")},render:function(){if(h.__super__.render.apply(this,arguments),this.model.get("thumbnail_pic")){var a=this.model.clone();a.url=null,this.append(g,".thumbnail_pic-container",{model:a})}},repost:function(a){return a.preventDefault(),this._removeActiveCommentRepostList(),"mini-repost-list"==this.activeListName?(this.activeListName=null,void 0):(this._setupList(e),void 0)},comment:function(a){return a.preventDefault(),this._removeActiveCommentRepostList(),"mini-comment-list"==this.activeListName?(this.activeListName=null,void 0):(this._setupList(f),void 0)},_setupList:function(a){var b=this.model.clone();b.url=null;var c=this.append(a,".stream-item-content > .tweet",{model:b});c.__enter(),this.activeListName=c.name,this.miniCommentRepostList=c},_removeActiveCommentRepostList:function(){this.miniCommentRepostList&&(this.miniCommentRepostList.destroy(),this.miniCommentRepostList=null)},favorite:function(a){a.preventDefault();var c=a.currentTarget;if(!c.disabled){c.disabled=!0;var d=c.classList.contains("favorited")?"destroy":"create",e=this.model.get("id");b.request({method:"POST",path:"favorites/"+d+".json",params:{id:e}},function(){c.disabled=!1,c.classList.toggle("favorited")})}},del:function(a){a.preventDefault();var c=this;b.request({method:"POST",path:"statuses/destroy.json",params:{id:this.model.get("id")}},function(){c.$el.slideUp(function(){c.destroy()})})}});return h}),define("less/app/1.0.0/views/stream-item.tpl",[],'{{#with user}}\n    {{> stream-item-vcard}}\n{{/with}}\n<div class="stream-item-content">\n    <div class="tweet">\n        {{> stream-item-tweet-content}}\n        {{#if retweeted_status}}\n            {{#with retweeted_status}}\n                <div class="tweet">\n                    {{> stream-item-tweet-content}}\n                    {{> stream-item-footer}}\n                </div>\n            {{/with}}\n        {{/if}}\n        {{> stream-item-footer}}\n    </div>\n</div>\n'),define("less/app/1.0.0/modules/mini-repost-list",["less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream"],function(a){var b=a("less/app/1.0.0/views/mini-repost-list.tpl"),c=a("less/app/1.0.0/modules/tweet-repost"),d=a("less/app/1.0.0/modules/mini-repost-body"),e=Backbone.Module.extend({name:"mini-repost-list",events:{"click .nav-prev":"navPrev","click .nav-next":"navNext"},template:b,initialize:function(){e.__super__.initialize.apply(this,arguments),this.__textModule=c,this.__bodyModule=d,this.options.data=_.defaults({},this.options.data,{count:10}),this.currentPage=0,this.totalPage=0},render:function(){this.$el.html(b),this.navEl=this.el.querySelector("footer .nav"),this.initBody();var a=this.model.clone();a.url=null,this.append(this.__textModule,".header",{model:a})},navPrev:function(){this.fetch(this.currentPage-1)},navNext:function(){this.fetch(this.currentPage+1)},checkNav:function(){this.navEl.querySelector(".nav-prev").disabled=1==this.currentPage,this.navEl.querySelector(".nav-next").disabled=this.currentPage==this.totalPage},_disableNav:function(){_.each(this.navEl.querySelectorAll("button"),function(a){a.disabled=!0})},getBodyModule:function(a){var b=_.extend({},this.options.data,{page:1,id:this.model.get("id")}),c={data:b};return this.append(this.__bodyModule,a,c)},initBody:function(){var a=this.getBodyModule(".body");a.on("fetch",function(a,b){this.currentPage=a;var c=this.totalPage=Math.ceil(b/this.options.data.count);c>1&&(this.navEl.hidden=!1,this.checkNav())}.bind(this)),this.__bodyMod=a},fetch:function(a){this._disableNav(),this.__bodyMod.fetch(a)}});return e}),define("less/app/1.0.0/views/mini-repost-list.tpl",[],'<div class="header"></div>\n<div class="body"></div>\n<footer>\n    <div class="nav" hidden>\n        <button class="nav-prev btn-link" i18n-content="prev">Prev</a></button>\n        <button class="nav-next btn-link" i18n-content="next">Next</a></button>\n    </div>\n</nav>\n'),define("less/app/1.0.0/modules/tweet-repost",["less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/modules/tweet-publisher-inline"),c=b.extend({name:"tweet-repost",url:"statuses/repost.json",__onRefresh:function(){this.model.get("retweeted_status")&&this.model.set({comment_ori:!0,ori_username:chrome.i18n.getMessage("commentToOrigin",this.model.get("retweeted_status").user.name)}),this.model.set({comment:chrome.i18n.getMessage("commentTo",this.model.get("user").name)})},getTextareaQuote:function(){return"//@"+this.model.get("user").name+":"+this.model.get("text")},getParameters:function(){var a={id:this.model.get("id"),status:this.getTextareaValue()},b=0;return this.el.querySelector(".js-comment").checked&&b++,this.el.querySelector(".js-commentOrigin")&&this.el.querySelector(".js-commentOrigin").checked&&b++,a.is_comment=b,a}});return c}),define("less/app/1.0.0/modules/tweet-publisher-inline",["less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/modules/tweet"),c=a("less/app/1.0.0/views/tweet-comment.tpl"),d=b.extend({className:"tweet-publisher-inline",template:c});return d}),define("less/app/1.0.0/modules/tweet",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/weibo"),c=a("less/app/1.0.0/message"),d=Backbone.Module.extend({name:"tweet-base",initialize:function(){this.on("repost",function(a){var b=this.el.querySelector(".status-editor");b.value=a,setTimeout(function(){b.focus()},0)},this),d.__super__.initialize.apply(this,arguments)},render:function(){d.__super__.render.apply(this,arguments),this.submitBtn=this.el.querySelector(".status-submit-btn");var a=this.getTextareaQuote&&this.getTextareaQuote()||"";this.trigger("repost",a),this.indicateCounter()},events:{"click .status-submit-btn":"connect","keyup .status-editor":"indicateCounter","focus .status-editor":"indicateCounter"},getTextareaValue:function(){var a=this.el.querySelector(".status-editor");return String(a.value).trim()},connect:function(a){a.preventDefault();var d=this.getTextareaValue(),e=this.el.querySelector(".status-editor"),f=this;if(""===d)return e.focus(),c.createMessage({text:chrome.i18n.getMessage("fieldEmpty")});var g=this.getParameters(),h=c.createMessage({text:chrome.i18n.getMessage("loading"),autoHide:!1}),i={method:"POST",path:this.url,params:g};return g.pic&&(i.multi=!0),b.request(i,function(){e.value="",f.trigger("connected"),h.hide(),c.createMessage({text:"Success"})}),!1},indicateCounter:function(){var a=this.getTextareaValue();a.length;var b=a.match(/[^\x00-\xff]/g),c=a.length+(b&&b.length)||0;c=Math.ceil(c/2);var d=140;this.submitBtn.disabled=!(c>0&&140>=c),this.counterCallback&&this.counterCallback(c,d)}});return d}),define("less/app/1.0.0/views/tweet-comment.tpl",[],'<form class="form-inline">\n    <textarea name="status" class="status-editor"></textarea>\n    <input type="submit" value="Submit" class="status-submit-btn btn btn-primary" disabled>\n</form>\n<div class="status-actions clearfix">\n    <ul class="status-actions-list">\n        <li></li>\n    </ul>\n</div>\n<ul class="status-aside">\n    {{#if comment}}\n        <li>\n            <label><input type="checkbox" name="comment" class="js-comment">{{comment}}</label>\n        </li>\n    {{/if}}\n    {{#if repost}}\n        <li>\n            <label><input type="checkbox" name="repost" class="js-repost">{{repost}}</label>\n        </li>\n    {{/if}}\n    {{#if comment_ori}}\n        <li>\n            <label><input type="checkbox" name="commentOrigin" class="js-commentOrigin">{{ori_username}}</label>\n        </li>\n    {{/if}}\n</ul>\n'),define("less/app/1.0.0/modules/mini-repost-body",["less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream"],function(a){a("less/app/1.0.0/views/mini-repost-body.tpl");var b=a("less/app/1.0.0/views/loading.tpl"),c=a("less/app/1.0.0/modules/mini-stream-item"),d=a("less/app/1.0.0/models/reposts"),e=Backbone.Module.extend({name:"mini-repost-body",tagName:"ul",placeholder:b,collection:new d,initialize:function(){e.__super__.initialize.apply(this,arguments);
var a=this;this.__item=c,this.__action="repost",this.collection.on("reset",function(b){var c=document.createDocumentFragment();b.each(function(b){b.url=null;var d=a.append(a.__item,c,{model:b});d.__enter({action:a.__action})}),a.$el.empty(),a.el.appendChild(c),a.trigger("fetch",a.options.data.page,a.collection.total_number)}),this.collection.on("add",function(b){var c=a.append(a.__item,a.el,{model:b});c.__enter()})},__setupCollectionEvent:function(){},render:function(){return this.collection.fetch({data:this.options.data}),this},fetch:function(a){this.options.data.page=a,this.render()}});return e}),define("less/app/1.0.0/views/mini-repost-body.tpl",[],"{{#if reposts.length}}\n\n{{else}}\n    <p>Empty!</p>\n{{/if}}\n"),define("less/app/1.0.0/views/loading.tpl",[],'<div class="loading-area">\n    <img src="images/loading.gif">\n    <span i18n-content="loading">Loading</span>\n</div>'),define("less/app/1.0.0/modules/mini-stream-item",["less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo"],function(a){var b=a("less/app/1.0.0/views/mini-stream-item.tpl");return Backbone.Module.extend({name:"mini-stream-item",className:"stream-item",tagName:"li",template:b,events:{"click .action-reply":"reply","click .action-repost":"repost"},__onRefresh:function(a){var b={};b[a.action]=!0,this.model.set("action_list",b)},reply:function(){var b=a("less/app/1.0.0/modules/tweet-reply"),c=this.model.clone();c.url=null;var d=new b({model:c});d.show()},repost:function(){var a="//@"+this.model.get("user").name+":"+this.model.get("text");this.trigger("repost",a)}})}),define("less/app/1.0.0/views/mini-stream-item.tpl",[],'{{#with user}}\n    {{> stream-item-vcard}}\n{{/with}}\n<div class="stream-item-content">\n    <div class="tweet">\n        <a href="#!/{{user.id}}" class="username">{{user.screen_name}}</a>: <p>{{ text }}</p>\n				<p>\n					{{#if action_list.reply}}\n						<button class="action-reply btn-link" i18n-content="reply">Reply</button>\n					{{/if}}\n					{{#if action_list.repost}}\n						 <button class="action-repost btn-link" i18n-content="repost">Repost</button>\n					{{/if}}\n				</p>\n    </div>\n</div>\n'),define("less/app/1.0.0/modules/tweet-reply",["less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo"],function(a){var b=a("less/app/1.0.0/modules/tweet-modal"),c=b.extend({url:"comments/reply.json",initialize:function(){this.model.set({title:chrome.i18n.getMessage("statusReplyTitle",this.model.get("user").name),actions_list:{}}),c.__super__.initialize.apply(this,arguments)},getTextareaQuote:function(){return chrome.i18n.getMessage("reply")+"@"+this.model.get("user").name+":"},getParameters:function(){return{comment:this.getTextareaValue(),id:this.model.get("status").id,cid:this.model.get("id")}}});return c}),define("less/app/1.0.0/modules/tweet-modal",["less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo"],function(a){var b=a("less/app/1.0.0/views/tweet-modal.tpl"),c=a("less/app/1.0.0/modules/tweet"),d=a("less/app/1.0.0/modules/weibo-emoticons"),e=c.extend({name:"tweet-modal",className:"modal hide",id:"status-modal",template:b,initialize:function(){e.__super__.initialize.apply(this,arguments);var a=this;this.$el.on("hidden",function(){a.destroy()}),this.on("connected",function(){a.$el.modal("hide")})},render:function(){e.__super__.render.apply(this,arguments),this.append(d,".tweet-emotion-container")},show:function(){this.__enter().$el.appendTo("body"),this.$el.modal("show")},counterCallback:function(a,b){var c=a-b,d=this.el.querySelector(".status-counter");d.textContent=String(-c),d.classList[c>0?"add":"remove"]("danger")}});return e}),define("less/app/1.0.0/views/tweet-modal.tpl",[],'<div class="modal-header">\n    <button type="button" i18n-values="title:close" class="close" data-dismiss="modal">x</button>\n    <h3>{{title}}</h3>\n</div>\n<div class="modal-body">\n    <textarea name="status" class="status-editor fullspace"></textarea>\n    <div class="status-actions clearfix">\n        <div class="pull-right">\n            <span class="status-counter">140</span>\n            <input type="submit" value="Submit" class="status-submit-btn btn btn-primary" disabled>\n        </div>\n        <ul class="status-actions-list">\n            <li class="tweet-emotion-container"></li>\n            {{#if actions_list.pic}}\n                <li class="dropdown" id="status-pic-dropdown">\n                    <a href="#status-pic-dropdown" class="pic-action" i18n-content="image">Image</a>\n                    <input type="file" class="status-pic-file visuallyhidden" accept="image/*">\n                    <ul class="dropdown-menu" id="status-pic-dropdown-menu">\n                        <li>\n                            <canvas class="status-pic-canvas" width="200"></canvas>\n                            <div class="actions">\n                                <button class="status-pic-del btn-link" i18n-content="delete">Delete</button>\n                            </div>\n                        </li>\n                    </ul>\n                </li>\n            {{/if}}\n            {{#if actions_list.geo}}\n                <li>\n                    <button id="status-geo-control" class="action-geo btn-link" i18n-content="enableGeolocation">Enable Geolocation</button>\n                </li>\n            {{/if}}\n            {{#if actions_list.topic}}\n                <li><a href="#" class="topic-action" i18n-content="topic">Topic</a></li>\n            {{/if}}\n        </ul>\n    </div>\n</div>\n\n'),define("less/app/1.0.0/modules/weibo-emoticons",["less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/views/weibo-emoticons.tpl"),c=a("less/app/1.0.0/models/weibo"),d=c.extend({url:"emotions.json",storeID:"emotions"}),e=Backbone.Module.extend({name:"weibo-emoticons",tagName:"span",className:"dropdown",template:b,initialize:function(){e.__super__.initialize.apply(this,arguments),this.model=new d,this.initialized=!1,this.pageNum=5,this.currentPage=1},render:function(){var a=this;this.initialized||this.model.fetch({success:function(){a.initialized=!0,a.initializeUI()}})},events:{"click .emoticons-body img":"appendFace","click .nav-prev":"navPrev","click .nav-next":"navNext","click .emoticons-category-list a":"showEmoticonsByCategory"},initializeUI:function(){this.$el.html(b);var a={};_.each(this.model.attributes,function(b,c){if(c==parseInt(c)){var d=b.category||"默认";a[d]||(a[d]=[]),a[d].push(b)}});var c=_.keys(a);this.model.set({emoticons:a,categories:c}),this.setupNav()},setupFaces:function(b){var c=a("less/app/1.0.0/views/weibo-emoticons-body.tpl"),d=Handlebars.compile(c),e=this.model.get("emoticons")[b];e=e.map(function(a){return a.title=a.phrase.slice(1,-1),a});var f=d({emoticons:e});this.$el.find(".emoticons-body").html(f)},setupNav:function(){var a=this.model.get("categories"),b=Math.ceil(a.length/this.pageNum);this.totalPage=b,this.renderNav(1),this.checkNav()},checkNav:function(){this.el.querySelector(".nav-prev").disabled=1==this.currentPage?!0:!1,this.el.querySelector(".nav-next").disabled=this.currentPage==this.totalPage?!0:!1},appendFace:function(a){var b=a.currentTarget,c=document.querySelector(".status-editor"),d=c.value,e=c.selectionStart,f=b.getAttribute("data-emoticon");c.value=d.slice(0,e)+f+d.slice(c.selectionEnd),c.selectionStart=c.selectionStart=e+f.length},renderNav:function(b){var c=a("less/app/1.0.0/views/weibo-emoticons-nav.tpl"),d=Handlebars.compile(c),e=this.model.get("categories"),f=e.slice((b-1)*this.pageNum,b*this.pageNum),g=d({categories:f});this.$el.find(".emoticons-category-list").html(g),this.setupFaces(f[0]),this.el.querySelector(".emoticons-category-list li:first-child").classList.add("active"),this.currentPage=b},navPrev:function(a){a.stopPropagation(),this.renderNav(this.currentPage-1),this.checkNav()},navNext:function(a){a.stopPropagation(),this.renderNav(this.currentPage+1),this.checkNav()},showEmoticonsByCategory:function(a){a.preventDefault(),a.stopPropagation(),this.el.querySelector(".emoticons-category-list .active").classList.remove("active");var b=a.currentTarget;b.parentNode.classList.add("active");var c=b.getAttribute("data-category");this.setupFaces(c)}});return e}),define("less/app/1.0.0/views/weibo-emoticons.tpl",[],'<a href="#" class="dropdown-toggle action-emoticons" data-toggle="dropdown" i18n-content="emoticons">Emoticons</a>\n<div class="dropdown-menu emoticons" role="menu">\n    <div class="emoticons-header">\n        <ul class="emoticons-category-list"></ul>\n        <div class="emoticons-nav">\n            <button class="nav-prev" disabled>&lt;</button>\n            <button class="nav-next" disabled>&gt;</button>\n        </div>\n    </div>\n    <div class="emoticons-body">\n        <div class="loadingArea">\n            <img src="images/loading.gif"><span i18n-content="loading">Loading</span>\n        </div>\n    </div>\n</div>'),define("less/app/1.0.0/views/weibo-emoticons-body.tpl",[],'<ul>\n    {{#each emoticons}}\n        <li>\n            <img width="22" height="22" title="{{this.title}}" data-emoticon="{{this.phrase}}" src="{{this.icon}}" alt="{{this.phrase}}">\n        </li>\n    {{/each}}\n</ul>\n'),define("less/app/1.0.0/views/weibo-emoticons-nav.tpl",[],'{{#each categories}}\n    <li>\n        <a href="#" data-category="{{this}}">{{this}}</a>\n    </li>\n{{/each}}\n'),define("less/app/1.0.0/models/reposts",["less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/stream");return b.extend({url:"statuses/repost_timeline.json",parse:function(a){return this.total_number=a.total_number,a.reposts}})}),define("less/app/1.0.0/models/stream",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/weibo"),c={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};return Backbone.Collection.extend({sync:function(a,d,e){var f={path:d.url,method:c[a],params:e.data};if(_.isString(d.storeID)){var g=e.success;if("read"==a){var h=localStorage.getItem(d.storeID);if(h)return h=JSON.parse(h),g(h)}e.success=function(a,b,c){localStorage.setItem(d.storeID,JSON.stringify(a)),g(a,b,c)}}b.request(f,{success:e.success,error:e.error})}})}),define("less/app/1.0.0/modules/mini-comment-list",["less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments"],function(a){var b=a("less/app/1.0.0/modules/mini-repost-list"),c=a("less/app/1.0.0/modules/tweet-comment"),d=a("less/app/1.0.0/modules/mini-comment-body"),e=b.extend({name:"mini-comment-list",initialize:function(){e.__super__.initialize.apply(this,arguments),this.__textModule=c,this.__bodyModule=d}});return e}),define("less/app/1.0.0/modules/tweet-comment",["less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/modules/tweet-publisher-inline");a("less/app/1.0.0/weibo");var c=b.extend({name:"tweet-comment",url:"comments/create.json",__onRefresh:function(){this.model.set({repost:chrome.i18n.getMessage("repostToMyTimeline")}),this.model.get("retweeted_status")&&this.model.set({comment_ori:!0,ori_username:chrome.i18n.getMessage("commentToOrigin",this.model.get("retweeted_status").user.name)})},getParameters:function(){var a=this.el.querySelector(".js-commentOrigin"),b=a&&a.checked,c=this.getTextareaValue(),d={id:this.model.get("id")};return this.el.querySelector(".js-repost").checked?(this.url="statuses/repost.json",d.status=c,d.is_comment=b?2:1):(this.url="comments/create.json",d.comment=c,b&&(d.comment_ori=b?1:0)),d}});return c}),define("less/app/1.0.0/modules/mini-comment-body",["less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/models/stream","less/app/1.0.0/models/comments"],function(a){var b=a("less/app/1.0.0/views/mini-comment-body.tpl"),c=a("less/app/1.0.0/modules/mini-repost-body"),d=a("less/app/1.0.0/models/comments"),e=c.extend({name:"mini-comment-body",template:b,collection:new d,initialize:function(){e.__super__.initialize.apply(this,arguments),this.__action="reply"}});return e}),define("less/app/1.0.0/views/mini-comment-body.tpl",[],'{{#if comments.length}}\n    {{#each comments}}\n        {{#module this name="mini-stream-item"}} {{/module}}\n    {{/each}}\n{{else}}\n    <p>Empty!</p>\n{{/if}}\n'),define("less/app/1.0.0/models/comments",["less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/stream"),c=b.extend({url:"comments/show.json",parse:function(a){return this.total_number=a.total_number,a.comments}});return c}),define("less/app/1.0.0/modules/stream-picture",["less/app/1.0.0/util"],function(a){var b=a("less/app/1.0.0/views/stream-picture.tpl"),c=a("less/app/1.0.0/util"),d=Backbone.Module.extend({name:"stream-picture",className:"tweet-pic",template:b,initialize:function(){d.__super__.initialize.apply(this,arguments),this.widthLimit=420,this.deg=0,this.options.expand&&this.model.set({expand:!0})},render:function(){d.__super__.render.apply(this,arguments),this.originalEl=this.el.querySelector(".tweet-pic-origin"),this.options.expand||(this.thumbEl=this.el.querySelector(".tweet-pic-thumb"),_.bindAll(this,"collapse"),this.$el.on("click",".tweet-pic-origin img",this.collapse),this.$el.on("click",".tweet-pic-origin canvas",this.collapse))},events:{"click .tweet-pic-thumb img":"show","click .action-collapse":"collapse","click .action-rotate-left":"rotateLeft","click .action-rotate-right":"rotateRight"},show:function(){this.inited?this.expand():this.load()},showThrobber:function(){var a=this.el.querySelector(".throbber"),b=this.el.querySelector(".tweet-pic-thumb img");a.style.left=b.width/2-8+"px",a.style.top=b.height/2-8+"px",a.style.display="block"},load:function(){this.showThrobber();var a=new Image;a.onload=this.onLoad.bind(this,a),a.src=this.model.get("original_pic")},onLoad:function(){this.$el.find(".throbber").remove(),this.inited=!0,this.expand()},_show:function(){var a,b=document.createElement("img");b.src=this.model.get("original_pic"),a=c.scale(b.width,b.height,this.widthLimit),b.width=a.width,b.height=a.height,this.originalEl.style.display="block",b.style.marginLeft=(this.widthLimit-a.width)/2+"px",this.originalEl.appendChild(b)},collapse:function(){var a=this.originalEl;a.removeChild(a.lastChild),a.style.display="none",this.thumbEl.style.display="block"},expand:function(){this.thumbEl.style.display="none",this._show()},rotateLeft:function(a){a.preventDefault(),this.deg-=90,this.rotate()},rotateRight:function(a){a.preventDefault(),this.deg+=90,this.rotate()},rotate:function(){var a=this.originalEl.querySelector("canvas"),b=document.createElement("img");b.src=this.model.get("original_pic"),a||(a=document.createElement("canvas"),this.originalEl.replaceChild(a,this.originalEl.querySelector("img")));var d=a.getContext("2d");this.deg=this.deg+360,this.deg%=360;var e,f=[b.width,b.height];this.deg/90%2&&(e=!0,f=[f[1],f[0]]);var g=c.scale(f[0],f[1],this.widthLimit),h=[];switch(this.deg){case 0:h[0]=0,h[1]=0;break;case 90:h[0]=g.width,h[1]=0;break;case 180:h[0]=g.width,h[1]=g.height;break;case 270:h[0]=0,h[1]=g.height}a.width=g.width,a.height=g.height,a.style.marginLeft=(this.widthLimit-g.width)/2+"px",d.save(),d.translate(0|h[0],0|h[1]),this.deg>0&&d.rotate(Math.PI*this.deg/180),e?d.drawImage(b,0,0,g.height,g.width):d.drawImage(b,0,0,g.width,g.height),d.restore()}});return d}),define("less/app/1.0.0/views/stream-picture.tpl",[],'{{#unless expand}}\n	<div class="tweet-pic-thumb" data-original="{{ original_pic }}"><img src="{{ thumbnail_pic }}"></div>\n	<img src="images/loading.gif" class="throbber" hidden>\n{{/unless}}\n<div class="tweet-pic-origin" {{#unless expand}}hidden{{/unless}}>\n    <div class="actions">\n				{{#unless expand}}<a href="#" class="action-collapse">收起</a>{{/unless}}\n        <a href="{{ original_pic }}" target="_blank" class="action-view-origin">查看大图</a>\n        <a href="#" class="action-rotate-left">左转</a>\n        <a href="#" class="action-rotate-right">右转</a>\n    </div>\n		{{#if expand}}<img src="{{ original_pic }}">{{/if}}\n</div>\n'),define("less/app/1.0.0/models/statuses",["less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/stream"),c=Backbone.Collection.extend({url:"statuses/home_timeline.json",parse:function(a){return a.statuses},comparator:function(a,b){return b.get("id")-a.get("id")},sync:b.prototype.sync,getNextCursor:function(){return{max_id:this.last().id}}});return c}),define("less/app/1.0.0/modules/timeline",[],function(a){var b=a("less/app/1.0.0/views/timeline.tpl"),c=Backbone.Module.extend({initialize:function(a){this.options={},this.options.cursor=a.cursor||"maxid";var b=this;_.bindAll(this,"_handleScroll"),document.addEventListener("scroll",this._handleScroll,!1),this.collection.on("reset",function(a){var c=document.createDocumentFragment();a.each(function(a){a.url=null;var d=b.append(b.__item,c,{model:a});d.__enter()}),b.el.querySelector(".stream").appendChild(c)}),this.collection.on("add",function(a,c,d){var e=document.createDocumentFragment(),f=d.position||"append",g=b.append(b.__item,e,{model:a});b.$el.find(".stream")[f](e),g.__enter()}),c.__super__.initialize.apply(this,arguments)},_handleScroll:function(){var a=document.body,b=100;if(!(this._scrollFetching||window.innerHeight+a.scrollTop+b<a.scrollHeight)){var c=this.collection.getNextCursor();if(c){var d=_.extend({},this.options.data,c),e={data:d,success:function(){this._scrollFetching=!1}.bind(this)};this._scrollFetching=!0,this.fetch(e)}}},fetch:function(a){var b=_.extend({},a,{add:!0});this.collection.fetch(b)},render:function(){return this.$el.html(b),this.collection.fetch({data:this.options.data}),this},destroy:function(){document.removeEventListener("scroll",this._handleScroll,!1),c.__super__.destroy.apply(this,arguments)}});return c}),define("less/app/1.0.0/views/timeline.tpl",[],'<div class="stream"></div>'),define("less/app/1.0.0/view_states/profile",["less/app/1.0.0/modules/profile-nav","less/app/1.0.0/modules/profile-card","less/app/1.0.0/models/user","less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/following","less/app/1.0.0/models/users","less/app/1.0.0/models/cursor","less/app/1.0.0/models/stream","less/app/1.0.0/modules/timeline","less/app/1.0.0/modules/user","less/app/1.0.0/modules/relationship-action","less/app/1.0.0/modules/followers","less/app/1.0.0/modules/user-timeline","less/app/1.0.0/models/statuses","less/app/1.0.0/modules/stream-item","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/reposts","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture"],function(a){return function(b){var c=a("less/app/1.0.0/views/profile.tpl"),d=a("less/app/1.0.0/modules/profile-nav"),e=a("less/app/1.0.0/modules/profile-card"),f=a("less/app/1.0.0/modules/following"),g=a("less/app/1.0.0/modules/followers"),h=a("less/app/1.0.0/modules/user-timeline"),i=Backbone.Module.extend({name:"profile",__parseParent:function(){return b.el},initialize:function(){this.__exports={"profile-timeline":".content-main","profile-following":".content-main","profile-followers":".content-main"},i.__super__.initialize.apply(this,arguments)},render:function(){return this.$el.html(c),this.append(d,".dashboard"),this.append(e,".profile-card-container"),this}}),j=Backbone.Module.extend({name:"profile-timeline",render:function(){return this.append(h,this.el,{uid:JSON.parse(localStorage.getItem("uid"))}),this}});b.register("u/:uid",i,j);var k=Backbone.Module.extend({name:"profile-following",render:function(){return this.append(f,this.el,{uid:JSON.parse(localStorage.getItem("uid"))}),this}});b.register("u/:uid/following",i,k);var l=Backbone.Module.extend({name:"profile-followers",render:function(){return this.append(g,this.el,{uid:JSON.parse(localStorage.getItem("uid"))}),this}});b.register("u/:uid/followers",i,l)}}),define("less/app/1.0.0/views/profile.tpl",[],'<div class="container">\n    <div class="profile-card-container"></div>\n    <div class="row standard-page-body">\n        <div class="dashboard span4"></div>\n        <div class="content-main span8"></div>\n    </div>\n</div>\n'),define("less/app/1.0.0/modules/profile-nav",[],function(a){var b=a("less/app/1.0.0/views/profile-nav.tpl"),c=Backbone.Module.extend({name:"profile-nav",template:b,initialize:function(){this.model=new Backbone.Model,this.model.url=null,c.__super__.initialize.apply(this,arguments)},__onRefresh:function(a){var b=a.params[0],c=a.path.split("/")[2]||"timeline",d=this.model.get("id");return d&&d!==b?(this.__activeNav="timeline",this.render({force:!0}),void 0):("undefined"!=typeof this.__activeNav&&this.__setupNav(c),this.model.set({id:b}),this.__activeNav=c,this.__id=b,void 0)},render:function(){c.__super__.render.apply(this,arguments),this.__setupNav(this.__activeNav)},__setupNav:function(a){var b="active",c=$("li[data-nav="+a+"]",this.$el).addClass(b);c.siblings().removeClass(b)}});return c}),define("less/app/1.0.0/views/profile-nav.tpl",[],'<ul class="nav nav-tabs nav-stacked">\n    <li data-nav="timeline"><a href="#u/{{id}}">Tweets</a></li>\n    <li data-nav="following"><a href="#u/{{id}}/following">Following</a></li>\n    <li data-nav="followers"><a href="#u/{{id}}/followers">Followers</a></li>\n</ul>'),define("less/app/1.0.0/modules/profile-card",["less/app/1.0.0/models/user","less/app/1.0.0/models/weibo","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/views/profile-card.tpl"),c=a("less/app/1.0.0/models/user"),d=Backbone.Module.extend({name:"profile-card",template:b,__onRefresh:function(a){var b=a.params[0],c=parseInt(b)==b?"uid":"screen_name";this.options.data={},this.options.data[c]=b,"undefined"!=typeof this.__id&&this.__id!==b&&this.render({force:!0}),this.__id=b},initialize:function(){this.model=new c,this.options={},d.__super__.initialize.apply(this,arguments)}});return d}),define("less/app/1.0.0/views/profile-card.tpl",[],'<div class="flex-module clearfix">\n    <img src="{{avatar_large}}" width="180" height="180" class="avator" alt="{{screen_name}}">\n    <div class="profile-card-inner">\n        <h1>{{screen_name}}</h1>\n        {{#if description}}\n            <p class="bio">{{description}}</p>\n        {{/if}}\n        <p>\n            <span class="location">{{location}}</span>\n            {{#if url}}\n                <span class="divider">.</span>\n                <a class="url" href={{url}} target="_blank">{{url}}</a>\n            {{/if}}\n        </p>\n    </div>\n    <div class="profile-card-actions">\n\n        {{> profile-stats}}\n    </div>\n</div>\n'),define("less/app/1.0.0/modules/following",["less/app/1.0.0/models/users","less/app/1.0.0/models/cursor","less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/timeline","less/app/1.0.0/modules/user","less/app/1.0.0/modules/relationship-action"],function(a){var b=a("less/app/1.0.0/models/users"),c=a("less/app/1.0.0/views/users.tpl"),d=a("less/app/1.0.0/modules/timeline"),e=a("less/app/1.0.0/modules/user"),f=b.extend({url:"friendships/friends.json"}),g=d.extend({name:"followings",template:c,__onRefresh:function(a){var b=a.params[0],c=parseInt(b)==b?"uid":"screen_name";this.options.data={},this.options.data[c]=b},initialize:function(){this.collection=new f,this.options={},this.__item=e,g.__super__.initialize.apply(this,arguments)}});return g}),define("less/app/1.0.0/models/users",["less/app/1.0.0/models/cursor","less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/cursor"),c=b.extend({parse:function(a){return c.__super__.parse.apply(this,arguments),a.users}});return c}),define("less/app/1.0.0/models/cursor",["less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/models/stream"),c=Backbone.Collection.extend({initialize:function(){this.__next_cursor=0},parse:function(a){this.__next_cursor=a.next_cursor},getNextCursor:function(){return 0===this.__next_cursor?null:{cursor:this.__next_cursor}},sync:b.prototype.sync});return c}),define("less/app/1.0.0/views/users.tpl",[],'<div class="stream">\n</div>\n'),define("less/app/1.0.0/modules/user",["less/app/1.0.0/modules/relationship-action","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/views/user.tpl"),c=a("less/app/1.0.0/modules/relationship-action"),d=Backbone.Module.extend({name:"user",tagName:"li",className:"stream-item",template:b,render:function(){return d.__super__.render.apply(this,arguments),this.append(c,".relationship-button-container",{following:this.model.get("following"),follow_me:this.model.get("follow_me"),user_id:this.model.get("id")}),this},follow:function(a){a.preventDefault();var b=a.target;if(!b.disabled){b.disabled=!0;var c=b.classList.contains("followed"),d=c?"destroy":"create";app.weibo.request("POST","friendships/"+d,{uid:this.model.id},function(){app.message.show(chrome.i18n.getMessage(a+"Success"),!0),b.disabled=!1,b.classList.toggle("followed");var a=c?"follow":"unfollow";b.textContent=chrome.i18n.getMessage(a)})}}});return d}),define("less/app/1.0.0/views/user.tpl",[],'{{> stream-item-vcard}}\n<div class="stream-item-content">\n	<div class="pull-right relationship-button-container"></div>\n	<strong>{{name}}</strong>\n	<p>{{description}}</p>\n</div>\n'),define("less/app/1.0.0/modules/relationship-action",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message"],function(a){var b=a("less/app/1.0.0/views/relationship-action.tpl"),c=a("less/app/1.0.0/weibo"),d=Backbone.Module.extend({name:"relationship-action",template:b,events:{"click .action-unfollow":"unfollow","click .action-follow":"follow"},initialize:function(a){this.model=new Backbone.Model(a),this.model.url=null,d.__super__.initialize.apply(this,arguments)},unfollow:function(a){a.preventDefault(),c.request({method:"POST",path:"friendships/destroy.json",params:{uid:this.model.get("user_id")}},function(){var b=$(a.currentTarget).parents(".relationship-container");b.removeClass("following")})},follow:function(a){a.preventDefault(),c.request({method:"POST",path:"friendships/create.json",params:{uid:this.model.get("user_id")}},function(){var b=$(a.currentTarget).parents(".relationship-container");b.addClass("following")})}});return d}),define("less/app/1.0.0/views/relationship-action.tpl",[],'<div class="relationship-container {{#if following}} following{{/if}}{{#if follow_me}} follow-me{{/if}}">\n	<a href="#" class="btn btn-primary relationship-btn">\n			<span class="btn-text action-following">Following</span>\n			<span class="btn-text action-follow">Follow</span>\n			<span class="btn-text action-unfollow">Unfollow</span>\n	</a>\n	<div class="relationship-mutual">{{#if following}}{{#if follow_me}}相互关注{{/if}}{{/if}}</div>\n</div>\n'),define("less/app/1.0.0/modules/followers",["less/app/1.0.0/models/users","less/app/1.0.0/models/cursor","less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/timeline","less/app/1.0.0/modules/user","less/app/1.0.0/modules/relationship-action"],function(a){var b=a("less/app/1.0.0/models/users"),c=a("less/app/1.0.0/views/users.tpl"),d=a("less/app/1.0.0/modules/timeline"),e=a("less/app/1.0.0/modules/user"),f=b.extend({url:"friendships/followers.json"}),g=d.extend({name:"followers",template:c,__onRefresh:function(a){var b=a.params[0],c=parseInt(b)==b?"uid":"screen_name";this.options.data={},this.options.data[c]=b},initialize:function(){this.collection=new f,this.__item=e,g.__super__.initialize.apply(this,arguments)}});return g}),define("less/app/1.0.0/modules/user-timeline",["less/app/1.0.0/models/statuses","less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/stream-item","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture","less/app/1.0.0/modules/timeline"],function(a){var b=a("less/app/1.0.0/views/user-timeline.tpl"),c=a("less/app/1.0.0/models/statuses"),d=a("less/app/1.0.0/modules/stream-item"),e=a("less/app/1.0.0/modules/timeline"),f=c.extend({url:"statuses/user_timeline.json"}),g=e.extend({name:"user-timeline",template:b,__onRefresh:function(a){var b=a.params[0],c=parseInt(b)==b?"uid":"screen_name";this.options.data={},this.options.data[c]=b},initialize:function(){this.collection=new f,this.options={},this.__item=d,g.__super__.initialize.apply(this,arguments)}});return g}),define("less/app/1.0.0/views/user-timeline.tpl",[],'<div class="stream">\n\n</div>'),define("less/app/1.0.0/view_states/connect",["less/app/1.0.0/modules/connect-nav","less/app/1.0.0/modules/profile-nav","less/app/1.0.0/modules/comments","less/app/1.0.0/modules/comment","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/user-comments","less/app/1.0.0/models/stream","less/app/1.0.0/models/statuses","less/app/1.0.0/modules/timeline","less/app/1.0.0/modules/mentions","less/app/1.0.0/modules/stream-item","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/models/reposts","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture"],function(a){var b=a("less/app/1.0.0/views/connect.tpl");
Array.prototype.slice;var c=a("less/app/1.0.0/modules/connect-nav"),d=a("less/app/1.0.0/modules/comments"),e=a("less/app/1.0.0/modules/mentions");return function(a){var f=Backbone.Module.extend({name:"connect",__parseParent:function(){return a.el},initialize:function(){this.__exports={"connect-comment":".content-main",mentions:".content-main"},f.__super__.initialize.apply(this,arguments)},render:function(){return this.$el.html(b),this.append(c,".dashboard"),this},__onRefresh:function(){}}),g=Backbone.Module.extend({name:"connect-comment",render:function(){return this.append(d,this.el,{uid:JSON.parse(localStorage.getItem("uid"))}),this}}),h=Backbone.Module.extend({name:"mentions",render:function(){return this.append(e,this.el,{uid:JSON.parse(localStorage.getItem("uid"))}),this}});a.register("connect",f,g),a.register("mentions",f,h)}}),define("less/app/1.0.0/views/connect.tpl",[],'<div class="container">\n    <div class="row">\n        <div class="dashboard span4"> </div>\n        <div class="content-main span8"> </div>\n    </div>\n</div>'),define("less/app/1.0.0/modules/connect-nav",["less/app/1.0.0/modules/profile-nav"],function(a){var b=a("less/app/1.0.0/views/connect-nav.tpl"),c=a("less/app/1.0.0/modules/profile-nav");return c.extend({name:"connect-nav",template:b,__onRefresh:function(a){var b=a.path;"undefined"!=typeof this.__activeNav&&this.__setupNav(b),this.__activeNav=b}})}),define("less/app/1.0.0/views/connect-nav.tpl",[],'<ul class="nav nav-tabs nav-stacked">\n    <li data-nav="connect"><a href="#connect">Comments</a></li>\n    <li data-nav="mentions"><a href="#mentions">Mentions</a></li>\n</ul>\n'),define("less/app/1.0.0/modules/comments",["less/app/1.0.0/modules/comment","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/user-comments","less/app/1.0.0/models/stream","less/app/1.0.0/models/statuses","less/app/1.0.0/modules/timeline"],function(a){a("less/app/1.0.0/views/comments-timeline.tpl"),Array.prototype.slice;var b=a("less/app/1.0.0/modules/comment"),c=a("less/app/1.0.0/models/user-comments"),d=a("less/app/1.0.0/modules/timeline"),e=d.extend({name:"comments-timeline",initialize:function(){this.collection=new c,this.__item=b,e.__super__.initialize.apply(this,arguments)}});return e}),define("less/app/1.0.0/views/comments-timeline.tpl",[],'<div class="stream">\n\n</div>\n'),define("less/app/1.0.0/modules/comment",["less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo"],function(a){var b=a("less/app/1.0.0/views/comment.tpl"),c=a("less/app/1.0.0/weibo");return Backbone.Module.extend({name:"comment",className:"stream-item",tagName:"li",template:b,events:{"click .action-reply":"reply","click .action-del":"del"},reply:function(){var b=a("less/app/1.0.0/modules/tweet-reply"),c=new b({model:this.model.clone()});c.show()},del:function(a){var b=this,d=a.currentTarget;d.disabled||(d.disabled=!0,c.request({method:"POST",path:"comments/destroy.json",params:{cid:this.model.get("id")}},function(){d.disabled=!1,b.$el.slideUp(function(){b.destroy()})}))}})}),define("less/app/1.0.0/views/comment.tpl",[],'{{#with user}}\n    {{> stream-item-vcard}}\n{{/with}}\n<div class="stream-item-content">\n    <div class="tweet">\n        <a href="#!/{{user.id}}" class="username">{{user.screen_name}}</a>: <p>{{ text }}</p>\n				<p class="pull-right">\n					<button class="action-reply btn-link" i18n-content="reply">Reply</button>\n					<button class="action-del btn-link" i18n-content="delete">Delete</button>\n				</p>\n				<span class="metadata">\n					<a href="#!/{{user.id}}/{{id}}">{{date_format created_at}}</a>\n					<span i18n-content="from">from</span> {{{ source }}}\n				</span>\n    </div>\n</div>\n'),define("less/app/1.0.0/models/user-comments",["less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/models/statuses"],function(a){a("less/app/1.0.0/models/stream");var b=a("less/app/1.0.0/models/statuses");return b.extend({url:"comments/timeline.json",parse:function(a){return a.comments}})}),define("less/app/1.0.0/modules/mentions",["less/app/1.0.0/models/statuses","less/app/1.0.0/models/stream","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/stream-item","less/app/1.0.0/modules/mini-repost-list","less/app/1.0.0/modules/tweet-repost","less/app/1.0.0/modules/tweet-publisher-inline","less/app/1.0.0/modules/tweet","less/app/1.0.0/modules/mini-repost-body","less/app/1.0.0/modules/mini-stream-item","less/app/1.0.0/modules/tweet-reply","less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo","less/app/1.0.0/models/reposts","less/app/1.0.0/modules/mini-comment-list","less/app/1.0.0/modules/tweet-comment","less/app/1.0.0/modules/mini-comment-body","less/app/1.0.0/models/comments","less/app/1.0.0/modules/stream-picture","less/app/1.0.0/modules/timeline"],function(a){var b=a("less/app/1.0.0/models/statuses"),c=a("less/app/1.0.0/modules/stream-item"),d=a("less/app/1.0.0/modules/timeline"),e=b.extend({url:"statuses/mentions.json"}),f=d.extend({name:"mentions-timeline",initialize:function(){this.collection=new e,this.__item=c,f.__super__.initialize.apply(this,arguments)}});return f}),define("less/app/1.0.0/modules/new-tweet",["less/app/1.0.0/modules/tweet-modal","less/app/1.0.0/modules/tweet","less/app/1.0.0/weibo","less/app/1.0.0/lib/oauth2","less/app/1.0.0/util","less/app/1.0.0/message","less/app/1.0.0/modules/weibo-emoticons","less/app/1.0.0/models/weibo"],function(a){function b(a,b){var c=new FileReader;c.onload=function(a){var c=new Image;c.onload=function(){b&&b(c)},c.src=a.target.result},c.readAsDataURL(a)}var c=a("less/app/1.0.0/modules/tweet-modal"),d=a("less/app/1.0.0/message"),e=a("less/app/1.0.0/util"),f=Backbone.View.extend({loadFile:function(a,c){var d,f=this;return a.size>5242880&&(d=new Error(chrome.i18n.getMessage("fileSizeError"))),d?c(d):(this.pic=a,b(a,function(a){var b=f.el.querySelector(".status-pic-canvas"),d=b.getContext("2d"),g=200,h=e.scale(a.width,a.height,g,g);b.height=h.height,d.clearRect(0,0,200,200),d.drawImage(a,parseInt((g-h.width)/2),0,h.width,h.height),c(null)}),void 0)},events:{"click .status-pic-del":"del"},show:function(){this.active=!0,this.$el.show()},del:function(){$(document).trigger("picture:del"),this.$el.hide(),this.pic=null,this.active=!1}}),g=c.extend({events:{"click .action-geo":"_toggleGeo","click .pic-action":"_triggerFileChange","change .status-pic-file":"_loadFile","click .topic-action":"_insertTopic"},initialize:function(){var a=this;this.model=new Backbone.Model,this.model.url=null,_.extend(this.events,g.__super__.events),this.model.set({title:chrome.i18n.getMessage("statusDefaultTitle"),actions_list:{pic:!0,geo:!0,topic:!0}}),this._setType("update"),$(document).on("picture:del",function(){a._setType("update")}),g.__super__.initialize.apply(this,arguments)},render:function(){return g.__super__.render.apply(this,arguments),this.picView=new f({el:this.el.querySelector("#status-pic-dropdown-menu")}),this},_toggleGeo:function(a){a.preventDefault();var b,c=a.currentTarget,d=this;c.checked?(c.textContent=chrome.i18n.getMessage("enableGeolocation"),this.geo=null,c.checked=!1):(navigator.geolocation.getCurrentPosition(function(a){d.geo={lat:a.coords.latitude,"long":a.coords.longitude},c.textContent=chrome.i18n.getMessage("disableGeolocation")}),b="enableGeolocation",c.checked=!0)},_triggerFileChange:function(a){a.preventDefault(),this.picView.active||this.el.querySelector(".status-pic-file").click()},_loadFile:function(a){a.preventDefault();var b=a.currentTarget,c=b.files[0],e=this;if(c){this.submitBtn.disabled=!0;var f=d.createMessage({text:chrome.i18n.getMessage("generatePreview"),autoHide:!1});this._setType("upload"),this.picView.loadFile(c,function(){e.picView.show(),e.indicateCounter(),f.hide()})}},_insertTopic:function(a){a.preventDefault();var b=chrome.i18n.getMessage("topicMessage"),c=this.el.querySelector(".status-editor"),d="#",e=d+b+d,f=c.value,g=f.indexOf(e);if(~g)c.selectionStart=g+1,c.selectionEnd=g+e.length-1;else{var h=c.selectionStart,i=c.selectionEnd;h!=i?(f=f.slice(0,h)+d+f.slice(h,i)+d+f.slice(i),c.value=f,c.selectionStart=h+1,c.selectionEnd=i+1):(f=f.slice(0,h)+e+f.slice(i),c.value=f,c.selectionStart=h+1,c.selectionEnd=h+b.length+1)}c.focus(),this.indicateCounter()},_setType:function(a){this.type=a;var b={update:"statuses/update.json",upload:"statuses/upload.json"};this.url=b[a]},getParameters:function(){var a=_.extend({status:this.getTextareaValue()},this.geo);return"upload"==this.type&&(a.pic=this.picView.pic),a}});return g});
